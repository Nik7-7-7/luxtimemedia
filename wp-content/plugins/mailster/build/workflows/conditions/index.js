(()=>{var e={6942:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function l(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,a(n)))}return e}function a(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return l.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(l.default=l,e.exports=l):void 0===(n=function(){return l}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var l=t[r];if(void 0!==l)return l.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(null,arguments)}const r=window.wp.element,l=window.wp.i18n,a=window.wp.blockEditor,s=window.wp.serverSideRender;var i=n.n(s);const o=window.wp.components,c=window.wp.data;function m(e){const{attributes:t,setAttributes:n,help:a="",label:s,title:m}=e,{conditions:d}=t,[u,h]=(0,r.useState)(!1),[f,p]=(0,r.useState)(!1),_=(0,c.useSelect)((e=>e("mailster/automation").getEmails()));return(0,r.useEffect)((()=>{const e=setInterval((function(){const t=document.querySelector(".mailster-conditions");t&&(h(!0),mailster.conditions.init(t),clearInterval(e))}),100);return()=>{clearInterval(e)}})),(0,r.useEffect)((()=>{d&&n({conditions:d.replace("&amp;","&")})}),[d]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.BaseControl,{label:s||(0,l.__)("Conditions","mailster"),help:a},d&&(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(i(),{block:"mailster-workflow/conditions",className:"conditions-preview",attributes:{...t,render:!0,plain:!1,emails:_},EmptyResponsePlaceholder:()=>(0,r.createElement)(o.Spinner,null)})),(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(o.Button,{variant:"secondary",onClick:()=>p(!0)},d?(0,l.__)("Change Conditions","mailster"):(0,l.__)("Add Conditions","mailster")),d&&(0,r.createElement)(o.Button,{variant:"link",isDestructive:!0,onClick:()=>n({conditions:void 0})},(0,l.__)("Clear","mailster")))),f&&(0,r.createElement)(o.Modal,{title:m||(0,l.__)("Define your conditions for this step","mailster"),className:"mailster-conditions-modal",onRequestClose:()=>p(!1),shouldCloseOnClickOutside:!0,__experimentalhideheader:!0},(0,r.createElement)(i(),{block:"mailster-workflow/conditions",attributes:{...t,emails:_}}),(0,r.createElement)("div",{className:"modal-conditions-buttons"},(0,r.createElement)(o.Button,{variant:"primary",disabled:!u,onClick:()=>{p(!1),n({conditions:mailster.conditions.serialize()})}},(0,l.__)("Save","mailster")),(0,r.createElement)(o.Button,{disabled:!u,variant:"secondary",onClick:()=>{p(!1)}},(0,l.__)("Cancel","mailster")))))}function d(e){const{attributes:t,setAttributes:n}=e,{weight:l}=t;return(0,r.createElement)(a.InspectorControls,null,(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(m,e))),!1)}const u=(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,r.createElement)("line",{x1:"6.5",y1:"8",x2:"6.5",y2:"16",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("circle",{cx:"17.5",cy:"5.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("circle",{cx:"6.5",cy:"18.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("circle",{cx:"6.5",cy:"5.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("path",{d:"M17.5,8h0a4,4,0,0,1-4,4h-3a4,4,0,0,0-4,4h0",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}));var h=n(6942),f=n.n(h);const p=window.wp.apiFetch;var _=n.n(p);const E=window.wp.date,w=(0,E.getSettings)(),y=((0,l.__)("Minute","mailster"),(0,l.__)("Minutes","mailster"),(0,l.__)("Hour","mailster"),(0,l.__)("Hours","mailster"),(0,l.__)("Day","mailster"),(0,l.__)("Days","mailster"),(0,l.__)("Week","mailster"),(0,l.__)("Weeks","mailster"),(0,l.__)("Month","mailster"),(0,l.__)("Months","mailster"),(0,l.__)("Specific Time of the day","mailster"),(0,l.__)("Specific day of the week","mailster"),(0,l.__)("Specific day of the month","mailster"),(0,l.__)("Specific date","mailster"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"1st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"2nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"3rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"4th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"5th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"6th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"7th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"8th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"9th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"10th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"11st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"12nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"13rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"14th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"15th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"16th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"17th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"18th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"19th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"20th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"21st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"22nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"23rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"24th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"25th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"26th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"27th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"28th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"29th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"30th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"31st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"Last"),w.l10n.weekdays.slice(w.l10n.startOfWeek),w.l10n.weekdays.slice(0,w.l10n.startOfWeek),w.l10n.startOfWeek,w.formats.date),b=w.formats.time;function k({id:e,align:t}){const n=new URL("https://kb.mailster.co/"+e);n.searchParams.set("utm_campaign","plugin"),n.searchParams.set("utm_medium","link"),n.searchParams.set("utm_source","Mailster Plugin"),n.searchParams.set("utm_term","workflow");var l={};return t&&(l.float=t),(0,r.createElement)("a",{className:"mailster-help",href:n.toString(),"data-article":e,style:l})}function g(e){const{attributes:n}=e,{id:s}=n,i=(0,c.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[m,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),f=function(e){const t=(0,c.useSelect)((e=>e("mailster/automation").getQueue()),[]),[n,l]=(0,r.useState)(0);return(0,r.useEffect)((()=>{t&&l(t[e]||0)}),[e,t]),n}(s),p=(0,l.sprintf)((0,l._n)("%s subscriber queued","%s subscribers queued",f,"mailster"),f);return(0,r.useEffect)((()=>{if(m&&s&&i)return f?void _()({path:"/mailster/v1/automations/queue/"+i+"/"+s}).then((e=>{h(e)})):h([])}),[m,i,s,f]),(0,r.createElement)(r.Fragment,null,f>0&&(0,r.createElement)("span",{className:"mailster-step-queued",title:p,onClick:()=>d(!0)},f),m&&(0,r.createElement)(o.Modal,{title:p,onRequestClose:()=>d(!1)},(0,r.createElement)(k,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)("div",{className:"mailster-queue-table"},!u&&(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(o.Spinner,null)))),u&&(0,r.createElement)(v,t({data:u,setData:h},e))),(0,r.createElement)(o.Tip,null,(0,l.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster"))),(0,r.createElement)(a.InspectorControls,null,f>0&&(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,{title:(0,l.__)("Queue","mailster")},(0,r.createElement)(k,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(o.Button,{onClick:()=>d(!0),variant:"secondary"},p))),(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(o.Tip,null,(0,l.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster"))))))}w.formats.datetime,w.formats.time.match(/[a|A]/),window.lodash,window.moment;const v=e=>{const{attributes:t,data:n,setData:a}=e,{id:s}=t,[i,m]=(0,r.useState)(!1),d=(0,c.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),u=(e,t,r,l)=>{const i="/mailster/v1/automations/queue/"+d+"/"+s+"/"+e.ID;m(!0),_()({path:i,method:r,data:l}).then((e=>{e&&a(n.filter(((e,n)=>n!==t))),m(!1),(0,c.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},h=(new Date).getTime(),f=n.map(((e,n)=>{const a=1e3*e.timestamp,s=1e3*e.added;return(0,r.createElement)("tr",{key:n},(0,r.createElement)("td",null,(0,r.createElement)(o.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id},e.email),0==e.status&&(0,r.createElement)("p",{className:"description"},(0,l.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster"))),(0,r.createElement)("td",null,e.trigger),(0,r.createElement)("td",null,s&&(0,r.createElement)(o.Tooltip,{text:(0,E.dateI18n)(y,s)+" @ "+(0,E.dateI18n)(b,s)},(0,r.createElement)("div",null,(0,E.humanTimeDiff)(s)))),(0,r.createElement)("td",null,a&&(0,r.createElement)(o.Tooltip,{text:(0,E.dateI18n)(y,a)+" @ "+(0,E.dateI18n)(b,a)},(0,r.createElement)("div",null,a>h?(0,E.humanTimeDiff)(a):(0,l.__)("right now","mailster")))),(0,r.createElement)("td",null,(0,r.createElement)(o.Button,{icon:"flag",disabled:i,label:(0,l.__)("Finish Journey","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(n)&&u(e,t,"POST",{finish:!0})})(e,n)}),(0,r.createElement)(o.Button,{icon:"controls-skipforward",disabled:i||1!=e.status||t.disabled,label:(0,l.__)("Forward to next step","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(n)&&u(e,t,"POST",{forward:!0})})(e,n)}),(0,r.createElement)(o.Button,{icon:"trash",disabled:i,isDestructive:!0,label:(0,l.__)("Remove entry","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(n)&&u(e,t,"DELETE")})(e,n)})))}));return(0,r.createElement)("table",{className:"wp-list-table widefat striped"},(0,r.createElement)("thead",null,(0,r.createElement)("tr",null,(0,r.createElement)("th",null,(0,l.__)("Subscriber","mailster")),(0,r.createElement)("th",null,(0,l.__)("Trigger","mailster")),(0,r.createElement)("th",null,(0,l.__)("Added","mailster")),(0,r.createElement)("th",null,(0,l.__)("Continues","mailster")),(0,r.createElement)("th",{style:{width:"150px"}},(0,l.__)("Actions","mailster")))),(0,r.createElement)("tbody",null,f))},S={label:(0,l.__)("Skip Step","mailster"),help:(0,l.__)("Skip this step when the workflow is executed.","mailster")},C={label:(0,l.__)("Skip Trigger","mailster"),help:(0,l.__)("Disable this trigger for the workflow.","mailster")};function P(e){const{attributes:t,setAttributes:n,name:l}=e,{disabled:s=!1}=t;if("mailster-workflow/stop"===l)return null;const i="mailster-workflow/trigger"==l?C:S;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(a.BlockControls,{group:"other"},(0,r.createElement)(o.ToolbarButton,{icon:s?"hidden":"visibility",isPressed:s,title:i.label,onClick:()=>n({disabled:!s||void 0})})),(0,r.createElement)(a.InspectorControls,null,(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(o.ToggleControl,{icon:s?"hidden":"visibility",label:i.label,help:i.help,checked:s,onChange:e=>n({disabled:!!e||void 0})}))))))}function x(e){const{attributes:t,setAttributes:n,name:s}=e,{comment:i=""}=t;return"mailster-workflow/trigger"===s?null:(0,r.createElement)(r.Fragment,null,i&&(0,r.createElement)("div",{className:"mailster-step-comment"},i),(0,r.createElement)(a.InspectorControls,null,(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(o.PanelRow,null,(0,r.createElement)(o.TextControl,{label:(0,l.__)("Comment","mailster"),help:(0,l.__)("Add a comment to help you understand your workflow.","mailster"),value:i,onChange:e=>n({comment:e||void 0})}))))))}function B(e){const{attributes:t}=e,{id:n}=t;if(n)return(0,r.createElement)(r.Fragment,null,(0,r.createElement)("span",{className:"mailster-step-id",title:sprintf((0,l.__)("Step ID : %s","mailster"),n)},n),(0,r.createElement)(a.InspectorControls,null,(0,r.createElement)(o.Panel,null,(0,r.createElement)(o.PanelBody,null,(0,r.createElement)(o.PanelRow,{className:"code"},sprintf((0,l.__)("Step ID : %s","mailster"),n))))))}function I(e){const{attributes:t,clientId:n,name:s,isSelectionEnabled:i}=e,{isExample:m}=t;if((0,c.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const d="mailster-workflow/triggers"===s?(0,l.__)("Click + to add a step","mailster"):(0,l.__)("Workflow Finished","mailster");return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.Tooltip,{text:(0,l.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,r.createElement)("span",{className:"workflow-finished "+s.replace("mailster-workflow/","workflow-finished-")},!m&&d)),i&&(0,r.createElement)(a.ButtonBlockAppender,null))}function N(e){const{attributes:t,setAttributes:n,children:l,className:s=[],hasStepId:i=!0,before:m,after:d,inspectorControls:u,isSelected:h,isIncomplete:p,clientId:_,blockAttributes:E={},isSelectionEnabled:w}=e,{id:y,disabled:b=!1}=t;!function(e){const[t,n]=(0,r.useState)();(0,r.useEffect)((()=>{new Promise((e=>{const t=(0,c.subscribe)((()=>{if((0,c.select)("core/editor").isCleanNewPost()||(0,c.select)("core/block-editor").getBlockCount()>0){const n=document.querySelector('iframe[name="editor-canvas"]'),r=n?n.contentWindow:window,l=()=>{r.removeEventListener("load",l),t(),e(r)};r.document.querySelector(".is-root-container")?l():r.addEventListener("load",l)}}))})).then((t=>{n(t.document),e&&e(t.document)}))}),[])}((e=>{e&&i&&(!y||e.querySelectorAll(".mailster-step-"+y).length>1)&&n({id:_.substring(30)})})),(0,r.useEffect)((()=>{if(h&&y)return history.replaceState(void 0,void 0,"#step-"+y),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[h]);const k=(0,r.useRef)();y&&s.push("mailster-step-"+y),p&&w&&s.push("mailster-step-incomplete"),b&&s.push("mailster-step-disabled");const v=(0,a.useBlockProps)({className:f()({},s),...E});return(0,r.createElement)(r.Fragment,null,u,(0,r.createElement)("div",v,m,(0,r.createElement)(o.Card,{className:"mailster-step",ref:k},(0,r.createElement)(x,e),(0,r.createElement)(P,e),(0,r.createElement)(g,e),(0,r.createElement)(B,e),(0,r.createElement)("div",{className:"mailster-step-inner"},l)),d,(0,r.createElement)("div",{className:"end-stop canvas-handle"})),(0,r.createElement)(I,e))}const D=[["mailster-workflow/condition-yes"],["mailster-workflow/condition-no"]],T=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/conditions","title":"Condition","category":"mailster-workflow-steps","keywords":["container","wrapper","row","section"],"parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"description":"Define a condition and branch of your path.","example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"weight":{"type":"float","default":0.5},"comment":{"type":"string"},"emails":{"type":"array"},"conditions":{"type":"string"},"render":{"type":"boolean"},"plain":{"type":"boolean"}},"providesContext":{"mailster-workflow/weight":"weight"},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:L,...O}=T;(0,e.registerBlockType)(L,{...O,icon:u,edit:function(e){const{attributes:n,setAttributes:s,isSelected:m,clientId:h}=e,{id:f,comment:p,conditions:_,weight:E}=n,w=(0,c.useSelect)((e=>e("mailster/automation").getEmails())),y="translateX("+-100*(.5-E)+"%)",b=(0,a.useInnerBlocksProps)({className:"canvas-handle",style:{transform:y}},{template:D,templateLock:"all"}),k=(0,l.__)("Check if","mailster");return(0,r.createElement)(N,t({},e,{className:["mailster-step-conditions","canvas-handle"],after:(0,r.createElement)("div",b),isIncomplete:!_,inspectorControls:(0,r.createElement)(d,e)}),(0,r.createElement)(o.CardBody,null,(0,r.createElement)("div",{className:"mailster-step-label"},(0,r.createElement)(o.Icon,{icon:u}),k),(0,r.createElement)("div",{className:"mailster-step-info"},_&&(0,r.createElement)(i(),{block:"mailster-workflow/conditions",attributes:{...n,render:!0,plain:!0,emails:w},EmptyResponsePlaceholder:()=>(0,r.createElement)(o.Spinner,null)}),!_&&(0,l.__)("Define a condition","mailster"))))},save:function(e){return(0,r.createElement)(a.InnerBlocks.Content,a.useBlockProps.save())}})})()})();