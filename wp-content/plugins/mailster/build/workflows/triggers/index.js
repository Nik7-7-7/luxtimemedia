(()=>{var e={6942:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function s(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=a(e,o(n)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return s.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=a(t,n));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(s.default=s,e.exports=s):void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{getActions:()=>h,getCampaignStats:()=>S,getCampaigns:()=>E,getEmails:()=>v,getFields:()=>_,getForms:()=>y,getLists:()=>g,getNumbers:()=>f,getQueue:()=>p,getTags:()=>w,getTriggers:()=>d});var t={};n.r(t),n.d(t,{clearNumbers:()=>P,getActions:()=>x,getCampaignStats:()=>D,getCampaigns:()=>q,getEmails:()=>z,getFields:()=>R,getForms:()=>V,getLists:()=>B,getNumbers:()=>C,getQueue:()=>L,getTags:()=>M,getTriggers:()=>b,setActions:()=>N,setCampaignStats:()=>W,setCampaigns:()=>O,setEmails:()=>j,setFields:()=>F,setForms:()=>U,setLists:()=>A,setNumbers:()=>T,setQueue:()=>I,setTags:()=>G,setTriggers:()=>k});var r={};n.r(r),n.d(r,{getActions:()=>re,getCampaignStats:()=>le,getCampaigns:()=>ie,getEmails:()=>ue,getFields:()=>ae,getForms:()=>ce,getLists:()=>se,getNumbers:()=>te,getQueue:()=>ne,getTags:()=>oe,getTriggers:()=>ee});var s={};n.r(s),n.d(s,{GET_ACTIONS:()=>ge,GET_CAMPAIGNS:()=>Se,GET_CAMPAIGN_STATS:()=>ye,GET_EMAILS:()=>ke,GET_FIELDS:()=>Ee,GET_FORMS:()=>ve,GET_LISTS:()=>we,GET_NUMBERS:()=>pe,GET_QUEUE:()=>he,GET_TAGS:()=>_e,GET_TRIGGERS:()=>fe});const o=window.wp.blocks,a=window.wp.element,i=window.wp.i18n,l=window.wp.editPost,c=window.wp.plugins,u=window.wp.data,m=window.wp.components;function d(e){const{triggers:t}=e;return t}function f(e){const{numbers:t}=e;return t}function p(e){const{queue:t}=e;return t}function h(e){const{actions:t}=e;return t}function g(e){const{lists:t}=e;return t}function w(e){const{tags:t}=e;return t}function _(e){const{fields:t}=e;return t}function E(e){const{campaigns:t}=e;return t}function S(e,t){const{stats:n}=e;return n[t]||[]}function y(e){const{forms:t}=e;return t}function v(e){const{emails:t}=e;return t}function k(e){return{type:"SET_TRIGGERS",triggers:e}}function b(e){return{type:"GET_TRIGGERS",path:e}}function T(e){return{type:"SET_NUMBERS",numbers:e}}function C(e){return{type:"GET_NUMBERS",path:e}}function I(e){return{type:"SET_QUEUE",queue:e}}function L(e){return{type:"GET_QUEUE",path:e}}function P(){return{type:"CLEAR_NUMBERS"}}function N(e){return{type:"SET_ACTIONS",actions:e}}function x(e){return{type:"GET_ACTIONS",path:e}}function A(e){return{type:"SET_LISTS",lists:e}}function B(e){return{type:"GET_LISTS",path:e}}function G(e){return{type:"SET_TAGS",tags:e}}function M(e){return{type:"GET_TAGS",path:e}}function F(e){return{type:"SET_FIELDS",fields:e}}function R(e){return{type:"GET_FIELDS",path:e}}function O(e){return{type:"SET_CAMPAIGNS",campaigns:e}}function q(e){return{type:"GET_CAMPAIGNS",path:e}}function W(e,t){return{type:"SET_CAMPAIGN_STATS",campaign:t,stats:e}}function D(e,t){return{type:"GET_CAMPAIGN_STATS",campaign:t,path:e}}function U(e){return{type:"SET_FORMS",forms:e}}function V(e){return{type:"GET_FORMS",path:e}}function j(e){return{type:"SET_EMAILS",emails:e}}function z(e){return{type:"GET_EMAILS",path:e}}function Q({id:e,align:t}){const n=new URL("https://kb.mailster.co/"+e);n.searchParams.set("utm_campaign","plugin"),n.searchParams.set("utm_medium","link"),n.searchParams.set("utm_source","Mailster Plugin"),n.searchParams.set("utm_term","workflow");var r={};return t&&(r.float=t),(0,a.createElement)("a",{className:"mailster-help",href:n.toString(),"data-article":e,style:r})}function H(){return new Promise((e=>{const t=(0,u.subscribe)((()=>{if((0,u.select)("core/editor").isCleanNewPost()||(0,u.select)("core/block-editor").getBlockCount()>0){const n=document.querySelector('iframe[name="editor-canvas"]'),r=n?n.contentWindow:window,s=()=>{r.removeEventListener("load",s),t(),e(r)};r.document.querySelector(".is-root-container")?s():r.addEventListener("load",s)}}))}))}function Y(e,t){const[n,r]=(0,a.useState)();return(0,a.useEffect)((()=>{H().then((t=>{r(t),e&&e(t)}))}),t||[]),n}function $(e){let t=null;H().then((n=>{(0,u.subscribe)((()=>{const r=n.document.querySelectorAll(".wp-block").length;r!==t&&(t=r,e(t))}))}))}function X(e,t,n=!0){const r=Z(e,t,n);return!!r.length&&r[0]}function Z(e,t=null,n=!0){const{getBlocks:r,getBlockRootClientId:s}=(0,u.select)("core/block-editor"),o=r(t);let a=[];return function t(r){r.forEach((r=>{r.name&&new RegExp(e,"g").test(r.name)&&(r.rootClientId=s(r.clientId),a.push(r)),n&&r.innerBlocks.length>0&&t(r.innerBlocks)}))}(o),a}function J(e,t){(0,u.dispatch)(t).invalidateResolutionForStoreSelector(e)}function K(e,t,n=!1){const r=(0,a.useRef)(null),s=(0,a.useRef)(e);return(0,a.useEffect)((()=>{s.current=e}),[e]),(0,a.useEffect)((()=>{const e=()=>s.current();if(n&&s.current&&e(),"number"==typeof t)return r.current=window.setInterval(e,t),()=>window.clearInterval(r.current)}),[t]),r}function*ee(){return k(yield b("/mailster/v1/automations/triggers"))}function*te(){const e=(0,u.select)("core/editor").getCurrentPostId();return T(yield C("/mailster/v1/automations/numbers/"+e))}function*ne(){const e=(0,u.select)("core/editor").getCurrentPostId();return I(yield L("/mailster/v1/automations/queue/"+e))}function*re(){return N(yield x("/mailster/v1/automations/actions"))}function*se(){return A(yield B("/mailster/v1/automations/lists"))}function*oe(){return G(yield M("/mailster/v1/automations/tags"))}function*ae(){return F(yield R("/mailster/v1/automations/fields"))}function*ie(){return O(yield q("/mailster/v1/automations/campaigns"))}function*le(e){return e?W(yield D("/mailster/v1/automations/stats/"+e,e),e):[]}function*ce(){return U(yield V("/mailster/v1/automations/forms"))}function*ue(){return j(yield z())}window.lodash,window.moment;const me=window.wp.apiFetch;var de=n.n(me);function fe(e){return de()({path:e.path})}function pe(e){return de()({path:e.path})}function he(e){return de()({path:e.path})}function ge(e){return de()({path:e.path})}function we(e){return de()({path:e.path})}function _e(e){return de()({path:e.path})}function Ee(e){return de()({path:e.path})}function Se(e){return de()({path:e.path})}function ye(e){return de()({path:e.path})}function ve(e){return de()({path:e.path})}function ke(e){return Z("mailster-workflow/email").map((e=>({name:e.attributes.name,campaign:e.attributes.campaign,id:e.attributes.id})))}const be={triggers:null,numbers:null,queue:null,actions:null,lists:[],tags:[],fields:[],campaigns:[],stats:[],emails:[]};(0,u.registerStore)("mailster/automation",{selectors:e,actions:t,resolvers:r,reducer:(e=be,t)=>{switch(t.type){case"SET_TRIGGERS":return{...e,triggers:t.triggers};case"SET_NUMBERS":return{...e,numbers:t.numbers};case"CLEAR_NUMBERS":return{...e,numbers:be.numbers};case"SET_QUEUE":return{...e,queue:t.queue};case"SET_ACTIONS":return{...e,actions:t.actions};case"SET_LISTS":return{...e,lists:t.lists};case"SET_TAGS":return{...e,tags:t.tags};case"SET_FIELDS":return{...e,fields:t.fields};case"SET_CAMPAIGNS":return{...e,campaigns:t.campaigns};case"SET_CAMPAIGN_STATS":let n={...e};return n.stats[t.campaign]=t.stats,n;case"SET_FORMS":return{...e,forms:t.forms};case"SET_EMAILS":return{...e,emails:t.emails};case"FAIL_RESOLUTION":return console.error(t),e;default:return e}},controls:s});const Te=window.wp.coreData;(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)("path",{fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9.925 3v6.794l4.661.01L7.66 19.985v-6.794L3 13.181z"}));const Ce=(0,window.wp.date.getSettings)();(0,i.__)("Minute","mailster"),(0,i.__)("Minutes","mailster"),(0,i.__)("Hour","mailster"),(0,i.__)("Hours","mailster"),(0,i.__)("Day","mailster"),(0,i.__)("Days","mailster"),(0,i.__)("Week","mailster"),(0,i.__)("Weeks","mailster"),(0,i.__)("Month","mailster"),(0,i.__)("Months","mailster"),(0,i.__)("Specific Time of the day","mailster"),(0,i.__)("Specific day of the week","mailster"),(0,i.__)("Specific day of the month","mailster"),(0,i.__)("Specific date","mailster"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"1st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"2nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"3rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"4th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"5th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"6th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"7th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"8th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"9th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"10th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"11st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"12nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"13rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"14th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"15th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"16th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"17th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"18th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"19th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"20th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"21st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"22nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"23rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"24th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"25th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"26th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"27th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"28th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"29th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"30th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"31st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"Last"),Ce.l10n.weekdays.slice(Ce.l10n.startOfWeek),Ce.l10n.weekdays.slice(0,Ce.l10n.startOfWeek),Ce.l10n.startOfWeek,Ce.formats.date,Ce.formats.time,Ce.formats.datetime,Ce.formats.time.match(/[a|A]/);const Ie=window.wp.blockEditor,Le=window.wp.compose,{Fill:Pe,Slot:Ne}=(0,m.createSlotFill)("mailster/trigger/selector");function xe(e){const[t,n]=(0,Te.useEntityProp)("postType","mailster-workflow","title");return(0,a.createElement)(l.PluginDocumentSettingPanel,{name:"options",title:(0,i.__)("Options","mailster")},(0,a.createElement)(m.PanelRow,null,(0,a.createElement)(m.TextControl,{label:(0,i.__)("Workflow Name","mailster"),value:t,onChange:e=>n(e),help:(0,i.__)("Define a name for your workflow.","mailster"),placeholder:(0,i.__)("Add Workflow name","mailster")})))}function Ae(e){const{attributes:t,setAttributes:n,isSelected:r,clientId:s}=e,{resetBlocks:o}=(0,u.useDispatch)("core/block-editor"),{__experimentalGetAllowedPatterns:l}=(0,u.useSelect)("core/block-editor"),{isCleanNewPost:c}=(0,u.useSelect)("core/editor"),[d,f]=(0,Te.useEntityProp)("postType","mailster-workflow","title"),[p,h]=(0,a.useState)([]),[g,w]=(0,a.useState)(!1);(0,a.useEffect)((()=>{c()&&(h(l()),w(!0))}),[]);const _=e=>{const t=wp.blocks.parse(e.content),n="mailster-workflow/scratch"==e.name;o(t),!d&&!n&&f(e.title||""),w(!1)};(0,a.useEffect)((()=>{if(!g)return;const e=setTimeout((()=>{0==p.length&&E()}),2e3);return()=>clearTimeout(e)}),[g]);const E=()=>{setTimeout((()=>{h(l())}),1),h([])};return g?(0,a.createElement)(m.Modal,{title:(0,i.__)("Choose a Workflow","mailster"),onRequestClose:()=>{window.location=window.location.href.replace("post-new.php","edit.php")},isFullScreen:!0,isDismissible:!0,shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,className:"mailster-patterns-modal"},(0,a.createElement)(Q,{id:"6460f6909a2fac195e609002",align:"right"}),(0,a.createElement)("div",{className:"mailster-patterns-explorer"},0==p.length&&(0,a.createElement)(m.Flex,{className:"mailster-patterns-loader",justify:"center"},(0,a.createElement)(m.FlexItem,null,(0,a.createElement)(m.BaseControl,null,(0,a.createElement)(m.Spinner,null),(0,a.createElement)(m.Button,{onClick:E,variant:"link"},(0,i.__)("Loading Workflows","mailster"))))),p&&p.map(((e,t)=>(0,a.createElement)(Be,{key:t,pattern:e,onInsertPattern:_}))))):(0,a.createElement)(a.Fragment,null)}function Be({pattern:e,onInsertPattern:t}){const n="mailster-pattern",{title:r,categories:s=[],blocks:o,article:l}=e,c=(0,a.useRef)(null),u=o.filter((e=>"mailster-workflow/comment"!=e.name)).map((e=>(e.attributes.isExample=!0,e))),d=()=>{t(e)},[f,p]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!c.current)return;const e=new IntersectionObserver((t=>{t[0].isIntersecting&&(p(!0),e.unobserve(c.current))}),{threshold:[0]});e.observe(c.current)}),[c.current]);const h=e.viewportWidth;return(0,a.createElement)(m.Card,{className:n,"aria-label":e.title,ref:c},(0,a.createElement)(m.Flex,{align:"center",justify:"space-between",className:`${n}-inner`},(0,a.createElement)(m.FlexItem,{className:`${n}-preview`,onClick:d},f&&(0,a.createElement)(Ie.BlockPreview,{blocks:u,viewportWidth:h,minHeight:344,additionalStyles:[{css:"body { padding: 16px }"}]})),(0,a.createElement)(m.FlexItem,{className:`${n}-actions`},(0,a.createElement)("h5",{className:`${n}-category`}),(0,a.createElement)("h3",{className:`${n}-title`},r),(0,a.createElement)("p",null,e.description),(0,a.createElement)(m.Button,{variant:"secondary",onClick:d},(0,i.__)("Start with this Workflow","mailster")),l&&(0,a.createElement)("p",null,(0,a.createElement)(m.ExternalLink,{href:l,target:"_blank"},(0,i.__)("Learn how to use this Workflow","mailster"))))))}function Ge(e){return(0,a.createElement)(l.PluginPostStatusInfo,null,(0,a.createElement)(m.PanelRow,null))}const Me=window.wp.primitives,Fe=(0,a.createElement)(Me.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Me.Path,{d:"M12 4L4 7.9V20h16V7.9L12 4zm6.5 14.5H14V13h-4v5.5H5.5V8.8L12 5.7l6.5 3.1v9.7z"})),Re=(0,a.createElement)(Me.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Me.Path,{d:"M7 11.5h10V13H7z"})),Oe=(0,a.createElement)(Me.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Me.Path,{d:"M18 11.2h-5.2V6h-1.6v5.2H6v1.6h5.2V18h1.6v-5.2H18z"}));function qe(){const e=(0,u.select)("core/editor").getCurrentPostId(),[t,n]=function(e,t){e="mailster_"+e;const[n,r]=(0,a.useState)((()=>{if("undefined"==typeof window)return t;try{const n=window.sessionStorage.getItem(e);return n?JSON.parse(n):t}catch(e){return console.error(e),t}}));return[n,t=>{try{const s=t instanceof Function?t(n):t;r(s),"undefined"!=typeof window&&window.sessionStorage.setItem(e,JSON.stringify(s))}catch(e){console.error(e)}}]}("workflow-"+e),r=document.querySelector('iframe[name="editor-canvas"]'),[s,o]=(0,a.useState)(),[l,c]=(0,a.useState)(),[d,f]=(0,a.useState)(),p=(0,Le.useDebounce)((()=>{let e=_();E(e.x,e.y),n(e)}),400);Y((e=>{const t=e.document;c(t.querySelector(".interface-interface-skeleton__content")||e),f(t.querySelector(".editor-styles-wrapper")),o(!0)})),(0,a.useEffect)((()=>{if(!d)return;let e,n,r,s;function o(t){t.preventDefault();const o=_();e=t.clientX-r,n=t.clientY-s,r=t.clientX,s=t.clientY;let a=Math.max(0,o.x-e),i=Math.max(0,o.y-n);w(a,i)}function a(e){d.classList.remove("dragging"),d.removeEventListener("mouseup",a),d.removeEventListener("mouseleave",a),d.removeEventListener("mousemove",o),l.addEventListener("scroll",p),g(_())}d.addEventListener("mousedown",(function(e){(e.target.classList.contains("is-root-container")||e.target.classList.contains("editor-styles-wrapper")||e.target.classList.contains("canvas-handle"))&&(r=e.clientX||e.changedTouches[0].clientX,s=e.clientY||e.changedTouches[0].clientY,d.classList.add("dragging"),d.addEventListener("mouseup",a),d.addEventListener("mouseleave",a),d.addEventListener("mousemove",o),l.removeEventListener("scroll",p))})),l.addEventListener("scroll",p),t?w(t.x,t.y,t.z):S(!0),d.classList.add("loaded")}),[d]);const h=e=>{w(t?.x,t?.y,e),g({z:e})},g=e=>{n({...t,...e})},w=(e,t,n)=>{d&&(l.scrollTo(e,t),n&&(d.style.scale=`${n}%`),E(e,t))},_=()=>({x:r?l.scrollX:l.scrollLeft,y:r?l.scrollY:l.scrollTop,z:100*(d.style.scale||1)}),E=(e,t)=>{};(0,a.useEffect)((()=>{d&&t&&h(t.z)}),[d]);const S=()=>{const e=d.querySelector(".wp-block-mailster-workflow-triggers");e?(setTimeout((()=>{e.scrollIntoView({inline:"center",block:"center",behavior:"smooth"})}),100),h(100)):w(0,0,100)},y=t?t.z:100;return s?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(m.Button,{variant:"tertiary",icon:Fe,onClick:S,label:(0,i.__)("Reset View","mailster")}),(0,a.createElement)(m.Button,{variant:"tertiary",icon:Re,disabled:40===y,onClick:()=>{h(Math.max(y-10,40))},label:(0,i.__)("Zoom Out","mailster")}),(0,a.createElement)(m.Button,{variant:"tertiary",icon:Oe,disabled:100===y,onClick:()=>{h(Math.min(y+10,100))},label:(0,i.__)("Zoom In","mailster")})):null}const We=(0,a.createElement)(Me.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Me.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})),De=(0,a.createElement)(Me.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(Me.Path,{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM15.5303 8.46967C15.8232 8.76256 15.8232 9.23744 15.5303 9.53033L13.0607 12L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7626 15.8232 14.4697 15.5303L12 13.0607L9.53033 15.5303C9.23744 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7626 8.46967 14.4697L10.9393 12L8.46967 9.53033C8.17678 9.23744 8.17678 8.76256 8.46967 8.46967C8.76256 8.17678 9.23744 8.17678 9.53033 8.46967L12 10.9393L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z"})),Ue=(0,i.__)("You have reached the limit of %d workflows! Your workflow is saved but disabled. Please upgrade your plan to use more workflows.","mailster");function Ve(e){const{createNotice:t,removeNotice:n}=(0,u.useDispatch)("core/notices"),{editPost:r}=(0,u.useDispatch)("core/editor"),{isAutosavingPost:s,isSavingPost:o,isCleanNewPost:l}=(0,u.useSelect)("core/editor"),c=(0,u.useSelect)((e=>e("core/editor").getEditedPostAttribute("status")),[]),[d,f]=(0,a.useState)((0,u.select)("core/editor").getEditedPostAttribute("status")),[p,h]=(0,a.useState)(),g="publish"===c,w=(0,u.subscribe)((()=>{if(s())return;if(!o())return;const e=(0,u.select)("core/editor").getEditedPostAttribute("status");h("private"==e&&d!=e&&(0,i.sprintf)(Ue,3)),w()}));return(0,a.useEffect)((()=>{if(!p)return void n("upgrade-notice");const e={label:(0,i.__)("Upgrade your license","mailster"),variant:"primary",onClick:()=>window.open(window.location.origin+window.location.pathname.replace("post.php","edit.php")+"?page=mailster-pricing")};t("warning",p,{id:"upgrade-notice",isDismissible:!0,actions:[e]})}),[p]),(0,a.createElement)(m.Button,{onClick:()=>{f(g?"private":"publish"),r({status:g?"private":"publish"})},icon:g?We:De,variant:"secondary",isDestructive:!g},g?(0,i.__)("Workflow is Active","mailster"):(0,i.__)("Workflow is Inactive","mailster"))}H().then((e=>{e.addEventListener("popstate",je),je()}));const je=()=>{H().then((e=>{const t=location.hash.match(/#step-([a-z0-9]+)/);if(t){const n=e.document.querySelector(".mailster-step-"+t[1]);n&&(0,u.dispatch)("core/block-editor").flashBlock(n.dataset.block),n&&(0,u.dispatch)("core/block-editor").selectBlock(n.dataset.block),n&&n.scrollIntoView()}}))};function ze(){return ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ze.apply(null,arguments)}(0,c.registerPlugin)("mailster-automation-settings-panel",{render:function(){(0,u.select)("core/block-editor").getBlocks();const[e,t]=(0,a.useState)([]),n=e.length,r=(0,u.useSelect)((e=>e("mailster/automation").getNumbers())),s=r?r.finished:0,c=r?r.active:0,d=r?r.total:0,[f,p]=(0,a.useState)(!0),[h,g]=function(e){const t=(0,a.useRef)(e),[n,r]=(0,a.useState)(e===window),s=(0,a.useCallback)((()=>{r(!0)}),[n]),o=(0,a.useCallback)((()=>{r(!1)}),[n]);return(0,a.useEffect)((()=>{const e=t.current;return e?.addEventListener("focus",s),e?.addEventListener("blur",o),()=>{e?.removeEventListener("focus",s),e?.removeEventListener("blur",o)}})),[t,n]}(window);f&&K((()=>{J("getQueue","mailster/automation")}),g?2e3:2e4,g),f&&K((()=>{J("getCampaignStats","mailster/automation"),J("getNumbers","mailster/automation")}),g?15e3:3e4,g),Y((e=>{const t=document.querySelector(".edit-post-header__toolbar,.editor-header__toolbar");if(!t)return;const n=document.querySelector(".edit-post-visual-editor"),r=document.createElement("div");r.className="interface-interface-canvas-toolbar";const s=document.createElement("div");s.className="edit-post-header-toolbar-extra",document.querySelector(".edit-post-header-toolbar-extra")||(t.appendChild(s),n.prepend(r),(0,a.createRoot)(r).render((0,a.createElement)(qe,null)),(0,a.createRoot)(s).render((0,a.createElement)(Ve,null)))}),[]),$((()=>{const e=Z("mailster-workflow/triggers");if(e.length)e.length>1&&e.slice(1).map((e=>{(0,u.dispatch)("core/block-editor").updateBlockAttributes(e.clientId,{lock:!1}),(0,u.dispatch)("core/block-editor").removeBlock(e.clientId)}));else{const e=(0,o.createBlock)("mailster-workflow/triggers");(0,u.dispatch)("core/block-editor").insertBlock(e,0)}}));const[w,_]=(0,a.useState)();return $((()=>{H().then((e=>{const t=(e,n,r=0)=>[...e.querySelectorAll(n)].reduce(((e,s)=>Math.max(e,t(s,n,r+1))),r);X("mailster-workflow/conditions")?_(t(e.document.querySelector(".is-root-container"),".mailster-step-conditions")):_(0)}))})),(0,a.useEffect)((()=>{H().then((e=>{const t=e.document.querySelector(".editor-styles-wrapper");t&&(t.style.minWidth=800*w+"px")}))}),[w]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(Ae,null),(0,a.createElement)(l.PluginPrePublishPanel,{className:"my-plugin-pre-publish-panel",initialOpen:!0},(0,a.createElement)(m.PanelRow,null,(0,a.createElement)(m.BaseControl,null,!!n&&(0,a.createElement)("div",null,(0,a.createElement)("span",{className:"number"},n),(0,a.createElement)("span",{className:"label"},(0,i.__)("Invalid Steps","mailster")))))),(0,a.createElement)(Ge,null),(0,a.createElement)(l.PluginPostStatusInfo,{className:"status-numbers"},(0,a.createElement)(m.Flex,{align:"center",justify:"space-between"},(0,a.createElement)(m.FlexItem,null,(0,a.createElement)("span",{className:"label"},(0,i.__)("active","mailster")),(0,a.createElement)("span",{className:"number"},c)),(0,a.createElement)(m.FlexItem,null,(0,a.createElement)("span",{className:"label"},(0,i.__)("finished","mailster")),(0,a.createElement)("span",{className:"number"},s)),(0,a.createElement)(m.FlexItem,null,(0,a.createElement)("span",{className:"label"},(0,i.__)("total","mailster")),(0,a.createElement)("span",{className:"number"},d)))),(0,a.createElement)(xe,null))},icon:!1});var Qe=n(6942),He=n.n(Qe);function Ye(e){const t=(0,u.useSelect)((e=>e("mailster/automation").getTriggers())),n=Z("mailster-workflow/trigger").length-1||0,r=(0,i._n)("There is %d trigger in this workflow.","There are %d triggers in this workflow.",n,"mailster");return(0,a.createElement)(Ie.InspectorControls,null,t&&(0,a.createElement)(m.Panel,null,(0,a.createElement)(m.PanelBody,null,(0,a.createElement)(m.PanelRow,null,(0,i.sprintf)(r,n)))))}function $e(e){const{attributes:t,clientId:n,name:r,isSelectionEnabled:s}=e,{isExample:o}=t;if((0,u.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const l="mailster-workflow/triggers"===r?(0,i.__)("Click + to add a step","mailster"):(0,i.__)("Workflow Finished","mailster");return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(m.Tooltip,{text:(0,i.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,a.createElement)("span",{className:"workflow-finished "+r.replace("mailster-workflow/","workflow-finished-")},!o&&l)),s&&(0,a.createElement)(Ie.ButtonBlockAppender,null))}const Xe=(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)("path",{fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9.925 3v6.794l4.661.01L7.66 19.985v-6.794L3 13.181z"})),Ze=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/triggers","title":"Triggers","category":"mailster-workflow-steps","description":"Define how this workflow gets triggered.","example":{},"supports":{"html":false,"reusable":false,"multiple":false,"className":false,"customClassName":false,"inserter":false,"renaming":false,"lock":false},"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:Je,...Ke}=Ze;(0,o.registerBlockType)(Je,{...Ke,icon:Xe,__experimentalLabel:function(e,{context:t}){const{content:n}=e;return n},edit:function(e){const t=["mailster-step-triggers","canvas-handle"],[n,r]=(0,a.useState)(0),{moveBlockToPosition:s}=(0,u.useDispatch)("core/block-editor"),{getBlockRootClientId:o,getBlocks:i}=(0,u.useSelect)("core/block-editor"),l=i();n&&t.push("mailster-step-count-"+n),(0,a.useEffect)((()=>{const e=document.querySelector(".wp-block-mailster-workflow-triggers");e&&e.scrollIntoView({inline:"center"})}),[]),(0,a.useEffect)((()=>{const e=i()[0];if(e&&"mailster-workflow/triggers"!==e.name){const t=X("mailster-workflow/triggers"),n=o(e.clientId);(0,u.dispatch)("core/block-editor").updateBlockAttributes(t.clientId,{lock:!1}),s(t.clientId,n,n,0)}r(Z("mailster-workflow/trigger").length)}),[l]);const c=(0,Ie.useInnerBlocksProps)({className:"canvas-handle"},{template:[["mailster-workflow/trigger",{}]],orientation:"horizontal"}),m=(0,Ie.useBlockProps)({className:He()({},t)});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(Ye,e),(0,a.createElement)("div",m,(0,a.createElement)("div",c),(0,a.createElement)("div",{className:"wrap-line canvas-handle"})),(0,a.createElement)($e,ze({},e,{className:"trigger-appender"})))},save:function(e){return(0,a.createElement)(Ie.InnerBlocks.Content,Ie.useBlockProps.save())}})})()})();