(()=>{var e={6942:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,l(n)))}return e}function l(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(null,arguments)}const r=window.wp.element,a=window.wp.i18n,l=window.wp.components,s=window.wp.blockEditor,i=window.wp.data;function o({id:e,align:t}){const n=new URL("https://kb.mailster.co/"+e);n.searchParams.set("utm_campaign","plugin"),n.searchParams.set("utm_medium","link"),n.searchParams.set("utm_source","Mailster Plugin"),n.searchParams.set("utm_term","workflow");var a={};return t&&(a.float=t),(0,r.createElement)("a",{className:"mailster-help",href:n.toString(),"data-article":e,style:a})}function m(e){const{attributes:t,setAttributes:n}=e,{id:m,email:c,subject:u,message:d}=t,f=(0,i.useSelect)((e=>e("core").getCurrentUser()),[]),h=(0,i.useSelect)((e=>{if(f)return e("core").getUser(f.id)}),[f]);return(0,r.useEffect)((()=>{!c&&h&&n({email:h.email})}),[h]),(0,r.useEffect)((()=>{m&&(!u&&n({subject:(0,a.sprintf)((0,a.__)("Step #%s reached!","mailster"),m)}),!d&&n({message:(0,a.sprintf)((0,a.__)("Step #%s has been reached!","mailster"),m)}))}),[m,u,d]),(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(o,{id:"66336f5b0cfcb4508af6ae55",align:"right"}),(0,r.createElement)(l.TextControl,{label:(0,a.__)("Email","mailster"),type:"email",value:c,onChange:e=>{n({email:e})},help:(0,a.__)("Define an email address for the notification.","mailster"),placeholder:(0,a.__)("Add email","mailster")}),(0,r.createElement)(l.TextControl,{label:(0,a.__)("Subject","mailster"),type:"subject",value:u,onChange:e=>{n({subject:e})},help:(0,a.__)("Set a subject.","mailster"),placeholder:(0,a.__)("Add subject","mailster")}),(0,r.createElement)(l.TextareaControl,{label:(0,a.__)("Message","mailster"),type:"message",rows:10,value:d,onChange:e=>{n({message:e})},help:(0,a.__)("Set a message.","mailster"),placeholder:(0,a.__)("Add message","mailster")}),(0,r.createElement)(l.Tip,null,(0,a.sprintf)((0,a.__)("You can use placeholders like %s or %s to add subscriber data to your message.","mailster"),"{firstname}","{lastname}")))))}window.lodash,window.moment;const c=(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,r.createElement)("line",{x1:"21",y1:"3.5",x2:"20.0213",y2:"4.15246",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("line",{x1:"22",y1:"9",x2:"21.0213",y2:"9",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("line",{x1:"3",y1:"3.5",x2:"3.9787",y2:"4.15246",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("line",{x1:"2",y1:"9",x2:"2.9787",y2:"9",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("path",{d:"M14,20a2.5,2.5,0,0,1-4,0",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("path",{d:"M6.375,13.05244V9.625A5.625,5.625,0,0,1,12,4h0a5.625,5.625,0,0,1,5.625,5.625v3.42745h-.00425l1.29,1.291a2,2,0,0,1-1.41512,3.41366H6.50437a2,2,0,0,1-1.41512-3.41366l1.29-1.291",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,r.createElement)("path",{d:"M0,0H24V24H0Z",fill:"none"}));var u=n(6942),d=n.n(u);const f=window.wp.apiFetch;var h=n.n(f);const p=window.wp.date,_=(0,p.getSettings)(),E=((0,a.__)("Minute","mailster"),(0,a.__)("Minutes","mailster"),(0,a.__)("Hour","mailster"),(0,a.__)("Hours","mailster"),(0,a.__)("Day","mailster"),(0,a.__)("Days","mailster"),(0,a.__)("Week","mailster"),(0,a.__)("Weeks","mailster"),(0,a.__)("Month","mailster"),(0,a.__)("Months","mailster"),(0,a.__)("Specific Time of the day","mailster"),(0,a.__)("Specific day of the week","mailster"),(0,a.__)("Specific day of the month","mailster"),(0,a.__)("Specific date","mailster"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"1st"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"2nd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"3rd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"4th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"5th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"6th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"7th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"8th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"9th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"10th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"11st"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"12nd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"13rd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"14th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"15th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"16th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"17th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"18th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"19th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"20th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"21st"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"22nd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"23rd"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"24th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"25th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"26th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"27th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"28th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"29th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"30th"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"31st"),(0,a.sprintf)((0,a.__)("%s day of the month","mailster"),"Last"),_.l10n.weekdays.slice(_.l10n.startOfWeek),_.l10n.weekdays.slice(0,_.l10n.startOfWeek),_.l10n.startOfWeek,_.formats.date),y=_.formats.time;function b(e){const{attributes:n}=e,{id:m}=n,c=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[u,d]=(0,r.useState)(!1),[f,p]=(0,r.useState)(!1),_=function(e){const t=(0,i.useSelect)((e=>e("mailster/automation").getQueue()),[]),[n,a]=(0,r.useState)(0);return(0,r.useEffect)((()=>{t&&a(t[e]||0)}),[e,t]),n}(m),E=(0,a.sprintf)((0,a._n)("%s subscriber queued","%s subscribers queued",_,"mailster"),_);return(0,r.useEffect)((()=>{if(u&&m&&c)return _?void h()({path:"/mailster/v1/automations/queue/"+c+"/"+m}).then((e=>{p(e)})):p([])}),[u,c,m,_]),(0,r.createElement)(r.Fragment,null,_>0&&(0,r.createElement)("span",{className:"mailster-step-queued",title:E,onClick:()=>d(!0)},_),u&&(0,r.createElement)(l.Modal,{title:E,onRequestClose:()=>d(!1)},(0,r.createElement)(o,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)("div",{className:"mailster-queue-table"},!f&&(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.Spinner,null)))),f&&(0,r.createElement)(w,t({data:f,setData:p},e))),(0,r.createElement)(l.Tip,null,(0,a.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster"))),(0,r.createElement)(s.InspectorControls,null,_>0&&(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,{title:(0,a.__)("Queue","mailster")},(0,r.createElement)(o,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.Button,{onClick:()=>d(!0),variant:"secondary"},E))),(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(l.Tip,null,(0,a.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster"))))))}_.formats.datetime,_.formats.time.match(/[a|A]/);const w=e=>{const{attributes:t,data:n,setData:s}=e,{id:o}=t,[m,c]=(0,r.useState)(!1),u=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),d=(e,t,r,a)=>{const l="/mailster/v1/automations/queue/"+u+"/"+o+"/"+e.ID;c(!0),h()({path:l,method:r,data:a}).then((e=>{e&&s(n.filter(((e,n)=>n!==t))),c(!1),(0,i.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},f=(new Date).getTime(),_=n.map(((e,n)=>{const s=1e3*e.timestamp,i=1e3*e.added;return(0,r.createElement)("tr",{key:n},(0,r.createElement)("td",null,(0,r.createElement)(l.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id},e.email),0==e.status&&(0,r.createElement)("p",{className:"description"},(0,a.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster"))),(0,r.createElement)("td",null,e.trigger),(0,r.createElement)("td",null,i&&(0,r.createElement)(l.Tooltip,{text:(0,p.dateI18n)(E,i)+" @ "+(0,p.dateI18n)(y,i)},(0,r.createElement)("div",null,(0,p.humanTimeDiff)(i)))),(0,r.createElement)("td",null,s&&(0,r.createElement)(l.Tooltip,{text:(0,p.dateI18n)(E,s)+" @ "+(0,p.dateI18n)(y,s)},(0,r.createElement)("div",null,s>f?(0,p.humanTimeDiff)(s):(0,a.__)("right now","mailster")))),(0,r.createElement)("td",null,(0,r.createElement)(l.Button,{icon:"flag",disabled:m,label:(0,a.__)("Finish Journey","mailster"),onClick:()=>((e,t)=>{const n=(0,a.sprintf)((0,a.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(n)&&d(e,t,"POST",{finish:!0})})(e,n)}),(0,r.createElement)(l.Button,{icon:"controls-skipforward",disabled:m||1!=e.status||t.disabled,label:(0,a.__)("Forward to next step","mailster"),onClick:()=>((e,t)=>{const n=(0,a.sprintf)((0,a.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(n)&&d(e,t,"POST",{forward:!0})})(e,n)}),(0,r.createElement)(l.Button,{icon:"trash",disabled:m,isDestructive:!0,label:(0,a.__)("Remove entry","mailster"),onClick:()=>((e,t)=>{const n=(0,a.sprintf)((0,a.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(n)&&d(e,t,"DELETE")})(e,n)})))}));return(0,r.createElement)("table",{className:"wp-list-table widefat striped"},(0,r.createElement)("thead",null,(0,r.createElement)("tr",null,(0,r.createElement)("th",null,(0,a.__)("Subscriber","mailster")),(0,r.createElement)("th",null,(0,a.__)("Trigger","mailster")),(0,r.createElement)("th",null,(0,a.__)("Added","mailster")),(0,r.createElement)("th",null,(0,a.__)("Continues","mailster")),(0,r.createElement)("th",{style:{width:"150px"}},(0,a.__)("Actions","mailster")))),(0,r.createElement)("tbody",null,_))},g={label:(0,a.__)("Skip Step","mailster"),help:(0,a.__)("Skip this step when the workflow is executed.","mailster")},k={label:(0,a.__)("Skip Trigger","mailster"),help:(0,a.__)("Disable this trigger for the workflow.","mailster")};function v(e){const{attributes:t,setAttributes:n,name:a}=e,{disabled:i=!1}=t;if("mailster-workflow/stop"===a)return null;const o="mailster-workflow/trigger"==a?k:g;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.BlockControls,{group:"other"},(0,r.createElement)(l.ToolbarButton,{icon:i?"hidden":"visibility",isPressed:i,title:o.label,onClick:()=>n({disabled:!i||void 0})})),(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.ToggleControl,{icon:i?"hidden":"visibility",label:o.label,help:o.help,checked:i,onChange:e=>n({disabled:!!e||void 0})}))))))}function S(e){const{attributes:t,setAttributes:n,name:i}=e,{comment:o=""}=t;return"mailster-workflow/trigger"===i?null:(0,r.createElement)(r.Fragment,null,o&&(0,r.createElement)("div",{className:"mailster-step-comment"},o),(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.TextControl,{label:(0,a.__)("Comment","mailster"),help:(0,a.__)("Add a comment to help you understand your workflow.","mailster"),value:o,onChange:e=>n({comment:e||void 0})}))))))}function x(e){const{attributes:t}=e,{id:n}=t;if(n)return(0,r.createElement)(r.Fragment,null,(0,r.createElement)("span",{className:"mailster-step-id",title:sprintf((0,a.__)("Step ID : %s","mailster"),n)},n),(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(l.Panel,null,(0,r.createElement)(l.PanelBody,null,(0,r.createElement)(l.PanelRow,{className:"code"},sprintf((0,a.__)("Step ID : %s","mailster"),n))))))}function C(e){const{attributes:t,clientId:n,name:o,isSelectionEnabled:m}=e,{isExample:c}=t;if((0,i.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const u="mailster-workflow/triggers"===o?(0,a.__)("Click + to add a step","mailster"):(0,a.__)("Workflow Finished","mailster");return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.Tooltip,{text:(0,a.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,r.createElement)("span",{className:"workflow-finished "+o.replace("mailster-workflow/","workflow-finished-")},!c&&u)),m&&(0,r.createElement)(s.ButtonBlockAppender,null))}function P(e){const{attributes:t,setAttributes:n,children:a,className:o=[],hasStepId:m=!0,before:c,after:u,inspectorControls:f,isSelected:h,isIncomplete:p,clientId:_,blockAttributes:E={},isSelectionEnabled:y}=e,{id:w,disabled:g=!1}=t;!function(e){const[t,n]=(0,r.useState)();(0,r.useEffect)((()=>{new Promise((e=>{const t=(0,i.subscribe)((()=>{if((0,i.select)("core/editor").isCleanNewPost()||(0,i.select)("core/block-editor").getBlockCount()>0){const n=document.querySelector('iframe[name="editor-canvas"]'),r=n?n.contentWindow:window,a=()=>{r.removeEventListener("load",a),t(),e(r)};r.document.querySelector(".is-root-container")?a():r.addEventListener("load",a)}}))})).then((t=>{n(t.document),e&&e(t.document)}))}),[])}((e=>{e&&m&&(!w||e.querySelectorAll(".mailster-step-"+w).length>1)&&n({id:_.substring(30)})})),(0,r.useEffect)((()=>{if(h&&w)return history.replaceState(void 0,void 0,"#step-"+w),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[h]);const k=(0,r.useRef)();w&&o.push("mailster-step-"+w),p&&y&&o.push("mailster-step-incomplete"),g&&o.push("mailster-step-disabled");const P=(0,s.useBlockProps)({className:d()({},o),...E});return(0,r.createElement)(r.Fragment,null,f,(0,r.createElement)("div",P,c,(0,r.createElement)(l.Card,{className:"mailster-step",ref:k},(0,r.createElement)(S,e),(0,r.createElement)(v,e),(0,r.createElement)(b,e),(0,r.createElement)(x,e),(0,r.createElement)("div",{className:"mailster-step-inner"},a)),u,(0,r.createElement)("div",{className:"end-stop canvas-handle"})),(0,r.createElement)(C,e))}const T=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/notification","title":"Notification","category":"mailster-workflow-steps","keywords":["notification","message"],"description":"Send a notification to an email address.","parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"email":{"type":"string","default":""},"subject":{"type":"string","default":""},"message":{"type":"string","default":""},"comment":{"type":"string"}},"textdomain":"mailster","editorScript":"file:./index.js"}'),{name:j,...I}=T;(0,e.registerBlockType)(j,{...I,__experimentalLabel:function(e,{context:t}){const{email:n,content:r,metadata:l}=e;return l?.name?l.name:(0,a.sprintf)((0,a.__)("Send Notification to %s","mailster"),n||"")||r},icon:c,edit:function(e){const{attributes:n,setAttributes:s,isSelected:i}=e,{email:o}=n,u=(0,a.__)("Send notification","mailster");return(0,r.createElement)(P,t({},e,{isIncomplete:!o,inspectorControls:(0,r.createElement)(m,e)}),(0,r.createElement)(l.CardBody,{size:"small"},(0,r.createElement)("div",{className:"mailster-step-label"},(0,r.createElement)(l.Icon,{icon:c}),u),o&&(0,r.createElement)("div",{className:"mailster-step-info"},(0,a.sprintf)((0,a.__)("to %s","mailster"),o))))},save:()=>null})})()})();