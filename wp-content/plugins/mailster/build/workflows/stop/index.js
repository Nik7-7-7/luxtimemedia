(()=>{var e={6942:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function s(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=a(e,l(n)))}return e}function l(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return s.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=a(t,n));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(s.default=s,e.exports=s):void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(null,arguments)}const r=window.wp.element,s=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components;function i(e){const{attributes:t,setAttributes:n}=e;return(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(a.Panel,null))}const o=(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,r.createElement)("g",{fill:"none"},(0,r.createElement)("path",{stroke:"#c3232d",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M10 12V3.5A1.5 1.5 0 0111.5 2v0A1.5 1.5 0 0113 3.5V12M10 5.5A1.5 1.5 0 008.5 4v0A1.5 1.5 0 007 5.5V12"}),(0,r.createElement)("path",{stroke:"#c3232d",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13 5.5A1.5 1.5 0 0114.5 4v0A1.5 1.5 0 0116 5.5V14l1.901-1.901a1.554 1.554 0 012.198 0v0c.524.524.605 1.345.194 1.961l-3.512 5.268A6 6 0 0111.789 22H10a6 6 0 01-6-6V7.5A1.5 1.5 0 015.5 6v0A1.5 1.5 0 017 7.5"})));var m=n(6942),c=n.n(m);const u=window.wp.data,d=window.wp.apiFetch;var h=n.n(d);const f=window.wp.date,p=(0,f.getSettings)(),_=((0,s.__)("Minute","mailster"),(0,s.__)("Minutes","mailster"),(0,s.__)("Hour","mailster"),(0,s.__)("Hours","mailster"),(0,s.__)("Day","mailster"),(0,s.__)("Days","mailster"),(0,s.__)("Week","mailster"),(0,s.__)("Weeks","mailster"),(0,s.__)("Month","mailster"),(0,s.__)("Months","mailster"),(0,s.__)("Specific Time of the day","mailster"),(0,s.__)("Specific day of the week","mailster"),(0,s.__)("Specific day of the month","mailster"),(0,s.__)("Specific date","mailster"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"1st"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"2nd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"3rd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"4th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"5th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"6th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"7th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"8th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"9th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"10th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"11st"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"12nd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"13rd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"14th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"15th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"16th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"17th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"18th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"19th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"20th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"21st"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"22nd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"23rd"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"24th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"25th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"26th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"27th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"28th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"29th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"30th"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"31st"),(0,s.sprintf)((0,s.__)("%s day of the month","mailster"),"Last"),p.l10n.weekdays.slice(p.l10n.startOfWeek),p.l10n.weekdays.slice(0,p.l10n.startOfWeek),p.l10n.startOfWeek,p.formats.date),w=p.formats.time;function E({id:e,align:t}){const n=new URL("https://kb.mailster.co/"+e);n.searchParams.set("utm_campaign","plugin"),n.searchParams.set("utm_medium","link"),n.searchParams.set("utm_source","Mailster Plugin"),n.searchParams.set("utm_term","workflow");var s={};return t&&(s.float=t),(0,r.createElement)("a",{className:"mailster-help",href:n.toString(),"data-article":e,style:s})}function y(e){const{attributes:n}=e,{id:i}=n,o=(0,u.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[m,c]=(0,r.useState)(!1),[d,f]=(0,r.useState)(!1),p=function(e){const t=(0,u.useSelect)((e=>e("mailster/automation").getQueue()),[]),[n,s]=(0,r.useState)(0);return(0,r.useEffect)((()=>{t&&s(t[e]||0)}),[e,t]),n}(i),_=(0,s.sprintf)((0,s._n)("%s subscriber queued","%s subscribers queued",p,"mailster"),p);return(0,r.useEffect)((()=>{if(m&&i&&o)return p?void h()({path:"/mailster/v1/automations/queue/"+o+"/"+i}).then((e=>{f(e)})):f([])}),[m,o,i,p]),(0,r.createElement)(r.Fragment,null,p>0&&(0,r.createElement)("span",{className:"mailster-step-queued",title:_,onClick:()=>c(!0)},p),m&&(0,r.createElement)(a.Modal,{title:_,onRequestClose:()=>c(!1)},(0,r.createElement)(E,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)("div",{className:"mailster-queue-table"},!d&&(0,r.createElement)(a.Panel,null,(0,r.createElement)(a.PanelBody,null,(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(a.Spinner,null)))),d&&(0,r.createElement)(b,t({data:d,setData:f},e))),(0,r.createElement)(a.Tip,null,(0,s.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster"))),(0,r.createElement)(l.InspectorControls,null,p>0&&(0,r.createElement)(a.Panel,null,(0,r.createElement)(a.PanelBody,{title:(0,s.__)("Queue","mailster")},(0,r.createElement)(E,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(a.Button,{onClick:()=>c(!0),variant:"secondary"},_))),(0,r.createElement)(a.PanelBody,null,(0,r.createElement)(a.Tip,null,(0,s.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster"))))))}p.formats.datetime,p.formats.time.match(/[a|A]/),window.lodash,window.moment;const b=e=>{const{attributes:t,data:n,setData:l}=e,{id:i}=t,[o,m]=(0,r.useState)(!1),c=(0,u.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),d=(e,t,r,s)=>{const a="/mailster/v1/automations/queue/"+c+"/"+i+"/"+e.ID;m(!0),h()({path:a,method:r,data:s}).then((e=>{e&&l(n.filter(((e,n)=>n!==t))),m(!1),(0,u.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},p=(new Date).getTime(),E=n.map(((e,n)=>{const l=1e3*e.timestamp,i=1e3*e.added;return(0,r.createElement)("tr",{key:n},(0,r.createElement)("td",null,(0,r.createElement)(a.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id},e.email),0==e.status&&(0,r.createElement)("p",{className:"description"},(0,s.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster"))),(0,r.createElement)("td",null,e.trigger),(0,r.createElement)("td",null,i&&(0,r.createElement)(a.Tooltip,{text:(0,f.dateI18n)(_,i)+" @ "+(0,f.dateI18n)(w,i)},(0,r.createElement)("div",null,(0,f.humanTimeDiff)(i)))),(0,r.createElement)("td",null,l&&(0,r.createElement)(a.Tooltip,{text:(0,f.dateI18n)(_,l)+" @ "+(0,f.dateI18n)(w,l)},(0,r.createElement)("div",null,l>p?(0,f.humanTimeDiff)(l):(0,s.__)("right now","mailster")))),(0,r.createElement)("td",null,(0,r.createElement)(a.Button,{icon:"flag",disabled:o,label:(0,s.__)("Finish Journey","mailster"),onClick:()=>((e,t)=>{const n=(0,s.sprintf)((0,s.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(n)&&d(e,t,"POST",{finish:!0})})(e,n)}),(0,r.createElement)(a.Button,{icon:"controls-skipforward",disabled:o||1!=e.status||t.disabled,label:(0,s.__)("Forward to next step","mailster"),onClick:()=>((e,t)=>{const n=(0,s.sprintf)((0,s.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(n)&&d(e,t,"POST",{forward:!0})})(e,n)}),(0,r.createElement)(a.Button,{icon:"trash",disabled:o,isDestructive:!0,label:(0,s.__)("Remove entry","mailster"),onClick:()=>((e,t)=>{const n=(0,s.sprintf)((0,s.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(n)&&d(e,t,"DELETE")})(e,n)})))}));return(0,r.createElement)("table",{className:"wp-list-table widefat striped"},(0,r.createElement)("thead",null,(0,r.createElement)("tr",null,(0,r.createElement)("th",null,(0,s.__)("Subscriber","mailster")),(0,r.createElement)("th",null,(0,s.__)("Trigger","mailster")),(0,r.createElement)("th",null,(0,s.__)("Added","mailster")),(0,r.createElement)("th",null,(0,s.__)("Continues","mailster")),(0,r.createElement)("th",{style:{width:"150px"}},(0,s.__)("Actions","mailster")))),(0,r.createElement)("tbody",null,E))},g={label:(0,s.__)("Skip Step","mailster"),help:(0,s.__)("Skip this step when the workflow is executed.","mailster")},k={label:(0,s.__)("Skip Trigger","mailster"),help:(0,s.__)("Disable this trigger for the workflow.","mailster")};function v(e){const{attributes:t,setAttributes:n,name:s}=e,{disabled:i=!1}=t;if("mailster-workflow/stop"===s)return null;const o="mailster-workflow/trigger"==s?k:g;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.BlockControls,{group:"other"},(0,r.createElement)(a.ToolbarButton,{icon:i?"hidden":"visibility",isPressed:i,title:o.label,onClick:()=>n({disabled:!i||void 0})})),(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(a.Panel,null,(0,r.createElement)(a.PanelBody,null,(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(a.ToggleControl,{icon:i?"hidden":"visibility",label:o.label,help:o.help,checked:i,onChange:e=>n({disabled:!!e||void 0})}))))))}function S(e){const{attributes:t,setAttributes:n,name:i}=e,{comment:o=""}=t;return"mailster-workflow/trigger"===i?null:(0,r.createElement)(r.Fragment,null,o&&(0,r.createElement)("div",{className:"mailster-step-comment"},o),(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(a.Panel,null,(0,r.createElement)(a.PanelBody,null,(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(a.TextControl,{label:(0,s.__)("Comment","mailster"),help:(0,s.__)("Add a comment to help you understand your workflow.","mailster"),value:o,onChange:e=>n({comment:e||void 0})}))))))}function P(e){const{attributes:t}=e,{id:n}=t;if(n)return(0,r.createElement)(r.Fragment,null,(0,r.createElement)("span",{className:"mailster-step-id",title:sprintf((0,s.__)("Step ID : %s","mailster"),n)},n),(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(a.Panel,null,(0,r.createElement)(a.PanelBody,null,(0,r.createElement)(a.PanelRow,{className:"code"},sprintf((0,s.__)("Step ID : %s","mailster"),n))))))}function C(e){const{attributes:t,clientId:n,name:i,isSelectionEnabled:o}=e,{isExample:m}=t;if((0,u.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const c="mailster-workflow/triggers"===i?(0,s.__)("Click + to add a step","mailster"):(0,s.__)("Workflow Finished","mailster");return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(a.Tooltip,{text:(0,s.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,r.createElement)("span",{className:"workflow-finished "+i.replace("mailster-workflow/","workflow-finished-")},!m&&c)),o&&(0,r.createElement)(l.ButtonBlockAppender,null))}function x(e){const{attributes:t,setAttributes:n,children:s,className:i=[],hasStepId:o=!0,before:m,after:d,inspectorControls:h,isSelected:f,isIncomplete:p,clientId:_,blockAttributes:w={},isSelectionEnabled:E}=e,{id:b,disabled:g=!1}=t;!function(e){const[t,n]=(0,r.useState)();(0,r.useEffect)((()=>{new Promise((e=>{const t=(0,u.subscribe)((()=>{if((0,u.select)("core/editor").isCleanNewPost()||(0,u.select)("core/block-editor").getBlockCount()>0){const n=document.querySelector('iframe[name="editor-canvas"]'),r=n?n.contentWindow:window,s=()=>{r.removeEventListener("load",s),t(),e(r)};r.document.querySelector(".is-root-container")?s():r.addEventListener("load",s)}}))})).then((t=>{n(t.document),e&&e(t.document)}))}),[])}((e=>{e&&o&&(!b||e.querySelectorAll(".mailster-step-"+b).length>1)&&n({id:_.substring(30)})})),(0,r.useEffect)((()=>{if(f&&b)return history.replaceState(void 0,void 0,"#step-"+b),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[f]);const k=(0,r.useRef)();b&&i.push("mailster-step-"+b),p&&E&&i.push("mailster-step-incomplete"),g&&i.push("mailster-step-disabled");const x=(0,l.useBlockProps)({className:c()({},i),...w});return(0,r.createElement)(r.Fragment,null,h,(0,r.createElement)("div",x,m,(0,r.createElement)(a.Card,{className:"mailster-step",ref:k},(0,r.createElement)(S,e),(0,r.createElement)(v,e),(0,r.createElement)(y,e),(0,r.createElement)(P,e),(0,r.createElement)("div",{className:"mailster-step-inner"},s)),d,(0,r.createElement)("div",{className:"end-stop canvas-handle"})),(0,r.createElement)(C,e))}const A=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/stop","title":"Stop","category":"mailster-workflow-steps","keywords":["stop"],"parent":["mailster-workflow/condition-yes","mailster-workflow/condition-no"],"description":"This is a stop block which prevents any further action in the workflow.","example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"comment":{"type":"string"}},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:T,...I}=A;(0,e.registerBlockType)(T,{...I,icon:o,edit:function(e){const{attributes:n,setAttributes:s,isSelected:l,clientId:a}=e;return(0,r.createElement)(x,t({},e,{inspectorControls:(0,r.createElement)(i,e)}),(0,r.createElement)("div",{className:"mailster-stop"},o))},save:()=>null})})()})();