(()=>{var e={6942:(e,t)=>{var a;!function(){"use strict";var l={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];a&&(e=s(e,r(a)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var a in e)l.call(e,a)&&e[a]&&(t=s(t,a));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):void 0===(a=function(){return n}.apply(t,[]))||(e.exports=a)}()}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var r=t[l]={exports:{}};return e[l](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)({}).hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},t.apply(null,arguments)}const l=window.wp.element,n=window.wp.i18n,r=window.wp.data,s=window.wp.components;var i=a(6942),o=a.n(i);const m=window.wp.blockEditor,c=window.wp.apiFetch;var u=a.n(c);const d=window.wp.date,p=(0,d.getSettings)(),h=((0,n.__)("Minute","mailster"),(0,n.__)("Minutes","mailster"),(0,n.__)("Hour","mailster"),(0,n.__)("Hours","mailster"),(0,n.__)("Day","mailster"),(0,n.__)("Days","mailster"),(0,n.__)("Week","mailster"),(0,n.__)("Weeks","mailster"),(0,n.__)("Month","mailster"),(0,n.__)("Months","mailster"),(0,n.__)("Specific Time of the day","mailster"),(0,n.__)("Specific day of the week","mailster"),(0,n.__)("Specific day of the month","mailster"),(0,n.__)("Specific date","mailster"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"1st"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"2nd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"3rd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"4th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"5th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"6th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"7th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"8th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"9th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"10th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"11st"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"12nd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"13rd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"14th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"15th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"16th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"17th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"18th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"19th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"20th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"21st"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"22nd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"23rd"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"24th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"25th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"26th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"27th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"28th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"29th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"30th"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"31st"),(0,n.sprintf)((0,n.__)("%s day of the month","mailster"),"Last"),p.l10n.weekdays.slice(p.l10n.startOfWeek),p.l10n.weekdays.slice(0,p.l10n.startOfWeek),p.l10n.startOfWeek,p.formats.date),f=p.formats.time;function _({id:e,align:t}){const a=new URL("https://kb.mailster.co/"+e);a.searchParams.set("utm_campaign","plugin"),a.searchParams.set("utm_medium","link"),a.searchParams.set("utm_source","Mailster Plugin"),a.searchParams.set("utm_term","workflow");var n={};return t&&(n.float=t),(0,l.createElement)("a",{className:"mailster-help",href:a.toString(),"data-article":e,style:n})}function E(e,t){(0,r.dispatch)(t).invalidateResolutionForStoreSelector(e)}function w(e){const{attributes:a}=e,{id:i}=a,o=(0,r.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[c,d]=(0,l.useState)(!1),[p,h]=(0,l.useState)(!1),f=function(e){const t=(0,r.useSelect)((e=>e("mailster/automation").getQueue()),[]),[a,n]=(0,l.useState)(0);return(0,l.useEffect)((()=>{t&&n(t[e]||0)}),[e,t]),a}(i),E=(0,n.sprintf)((0,n._n)("%s subscriber queued","%s subscribers queued",f,"mailster"),f);return(0,l.useEffect)((()=>{if(c&&i&&o)return f?void u()({path:"/mailster/v1/automations/queue/"+o+"/"+i}).then((e=>{h(e)})):h([])}),[c,o,i,f]),(0,l.createElement)(l.Fragment,null,f>0&&(0,l.createElement)("span",{className:"mailster-step-queued",title:E,onClick:()=>d(!0)},f),c&&(0,l.createElement)(s.Modal,{title:E,onRequestClose:()=>d(!1)},(0,l.createElement)(_,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,l.createElement)("div",{className:"mailster-queue-table"},!p&&(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.Spinner,null)))),p&&(0,l.createElement)(b,t({data:p,setData:h},e))),(0,l.createElement)(s.Tip,null,(0,n.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster"))),(0,l.createElement)(m.InspectorControls,null,f>0&&(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,{title:(0,n.__)("Queue","mailster")},(0,l.createElement)(_,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.Button,{onClick:()=>d(!0),variant:"secondary"},E))),(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.Tip,null,(0,n.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster"))))))}p.formats.datetime,p.formats.time.match(/[a|A]/),window.lodash,window.moment;const b=e=>{const{attributes:t,data:a,setData:i}=e,{id:o}=t,[m,c]=(0,l.useState)(!1),p=(0,r.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),_=(e,t,l,n)=>{const r="/mailster/v1/automations/queue/"+p+"/"+o+"/"+e.ID;c(!0),u()({path:r,method:l,data:n}).then((e=>{e&&i(a.filter(((e,a)=>a!==t))),c(!1),E("getQueue","mailster/automation")}))},w=(new Date).getTime(),b=a.map(((e,a)=>{const r=1e3*e.timestamp,i=1e3*e.added;return(0,l.createElement)("tr",{key:a},(0,l.createElement)("td",null,(0,l.createElement)(s.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id},e.email),0==e.status&&(0,l.createElement)("p",{className:"description"},(0,n.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster"))),(0,l.createElement)("td",null,e.trigger),(0,l.createElement)("td",null,i&&(0,l.createElement)(s.Tooltip,{text:(0,d.dateI18n)(h,i)+" @ "+(0,d.dateI18n)(f,i)},(0,l.createElement)("div",null,(0,d.humanTimeDiff)(i)))),(0,l.createElement)("td",null,r&&(0,l.createElement)(s.Tooltip,{text:(0,d.dateI18n)(h,r)+" @ "+(0,d.dateI18n)(f,r)},(0,l.createElement)("div",null,r>w?(0,d.humanTimeDiff)(r):(0,n.__)("right now","mailster")))),(0,l.createElement)("td",null,(0,l.createElement)(s.Button,{icon:"flag",disabled:m,label:(0,n.__)("Finish Journey","mailster"),onClick:()=>((e,t)=>{const a=(0,n.sprintf)((0,n.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(a)&&_(e,t,"POST",{finish:!0})})(e,a)}),(0,l.createElement)(s.Button,{icon:"controls-skipforward",disabled:m||1!=e.status||t.disabled,label:(0,n.__)("Forward to next step","mailster"),onClick:()=>((e,t)=>{const a=(0,n.sprintf)((0,n.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(a)&&_(e,t,"POST",{forward:!0})})(e,a)}),(0,l.createElement)(s.Button,{icon:"trash",disabled:m,isDestructive:!0,label:(0,n.__)("Remove entry","mailster"),onClick:()=>((e,t)=>{const a=(0,n.sprintf)((0,n.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(a)&&_(e,t,"DELETE")})(e,a)})))}));return(0,l.createElement)("table",{className:"wp-list-table widefat striped"},(0,l.createElement)("thead",null,(0,l.createElement)("tr",null,(0,l.createElement)("th",null,(0,n.__)("Subscriber","mailster")),(0,l.createElement)("th",null,(0,n.__)("Trigger","mailster")),(0,l.createElement)("th",null,(0,n.__)("Added","mailster")),(0,l.createElement)("th",null,(0,n.__)("Continues","mailster")),(0,l.createElement)("th",{style:{width:"150px"}},(0,n.__)("Actions","mailster")))),(0,l.createElement)("tbody",null,b))},g={label:(0,n.__)("Skip Step","mailster"),help:(0,n.__)("Skip this step when the workflow is executed.","mailster")},y={label:(0,n.__)("Skip Trigger","mailster"),help:(0,n.__)("Disable this trigger for the workflow.","mailster")};function v(e){const{attributes:t,setAttributes:a,name:n}=e,{disabled:r=!1}=t;if("mailster-workflow/stop"===n)return null;const i="mailster-workflow/trigger"==n?y:g;return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(m.BlockControls,{group:"other"},(0,l.createElement)(s.ToolbarButton,{icon:r?"hidden":"visibility",isPressed:r,title:i.label,onClick:()=>a({disabled:!r||void 0})})),(0,l.createElement)(m.InspectorControls,null,(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.ToggleControl,{icon:r?"hidden":"visibility",label:i.label,help:i.help,checked:r,onChange:e=>a({disabled:!!e||void 0})}))))))}function k(e){const{attributes:t,setAttributes:a,name:r}=e,{comment:i=""}=t;return"mailster-workflow/trigger"===r?null:(0,l.createElement)(l.Fragment,null,i&&(0,l.createElement)("div",{className:"mailster-step-comment"},i),(0,l.createElement)(m.InspectorControls,null,(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("Comment","mailster"),help:(0,n.__)("Add a comment to help you understand your workflow.","mailster"),value:i,onChange:e=>a({comment:e||void 0})}))))))}function S(e){const{attributes:t}=e,{id:a}=t;if(a)return(0,l.createElement)(l.Fragment,null,(0,l.createElement)("span",{className:"mailster-step-id",title:sprintf((0,n.__)("Step ID : %s","mailster"),a)},a),(0,l.createElement)(m.InspectorControls,null,(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,{className:"code"},sprintf((0,n.__)("Step ID : %s","mailster"),a))))))}function C(e){const{attributes:t,clientId:a,name:i,isSelectionEnabled:o}=e,{isExample:c}=t;if((0,r.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==a)return null;const u="mailster-workflow/triggers"===i?(0,n.__)("Click + to add a step","mailster"):(0,n.__)("Workflow Finished","mailster");return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(s.Tooltip,{text:(0,n.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,l.createElement)("span",{className:"workflow-finished "+i.replace("mailster-workflow/","workflow-finished-")},!c&&u)),o&&(0,l.createElement)(m.ButtonBlockAppender,null))}function P(e){const{attributes:t,setAttributes:a,children:n,className:i=[],hasStepId:c=!0,before:u,after:d,inspectorControls:p,isSelected:h,isIncomplete:f,clientId:_,blockAttributes:E={},isSelectionEnabled:b}=e,{id:g,disabled:y=!1}=t;!function(e){const[t,a]=(0,l.useState)();(0,l.useEffect)((()=>{new Promise((e=>{const t=(0,r.subscribe)((()=>{if((0,r.select)("core/editor").isCleanNewPost()||(0,r.select)("core/block-editor").getBlockCount()>0){const a=document.querySelector('iframe[name="editor-canvas"]'),l=a?a.contentWindow:window,n=()=>{l.removeEventListener("load",n),t(),e(l)};l.document.querySelector(".is-root-container")?n():l.addEventListener("load",n)}}))})).then((t=>{a(t.document),e&&e(t.document)}))}),[])}((e=>{e&&c&&(!g||e.querySelectorAll(".mailster-step-"+g).length>1)&&a({id:_.substring(30)})})),(0,l.useEffect)((()=>{if(h&&g)return history.replaceState(void 0,void 0,"#step-"+g),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[h]);const P=(0,l.useRef)();g&&i.push("mailster-step-"+g),f&&b&&i.push("mailster-step-incomplete"),y&&i.push("mailster-step-disabled");const N=(0,m.useBlockProps)({className:o()({},i),...E});return(0,l.createElement)(l.Fragment,null,p,(0,l.createElement)("div",N,u,(0,l.createElement)(s.Card,{className:"mailster-step",ref:P},(0,l.createElement)(k,e),(0,l.createElement)(v,e),(0,l.createElement)(w,e),(0,l.createElement)(S,e),(0,l.createElement)("div",{className:"mailster-step-inner"},n)),d,(0,l.createElement)("div",{className:"end-stop canvas-handle"})),(0,l.createElement)(C,e))}function N(e){const{attributes:t,setAttributes:a,campaignObj:i}=e,{campaign:o}=t,c=(0,r.useSelect)((e=>e("mailster/automation").getCampaigns()),[]),u=(0,r.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[d,p]=(0,l.useState)(!1);(0,l.useEffect)((()=>(window.mailster_receiver_post_id=e=>{a({campaign:void 0}),E("getCampaigns","mailster/automation"),setTimeout((()=>{a({campaign:e?parseInt(e,10):void 0})}),100),p(!1)},()=>{window.mailster_receiver_post_id=!1})),[]);const h=()=>{const e=i?.nonce,t=i?.edit_url,a=new URL(t),l=a.searchParams;l.set("post",o),l.set("action","edit"),l.set("workflow",u),l.set("nonce",e),p(a.toString())},f=()=>{const e=new URL(location.origin+location.pathname.replace("post.php","post-new.php")),t=e.searchParams;t.set("post_type","newsletter"),t.set("workflow",u),p(e.toString())};return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(m.BlockControls,{group:"inline"},(0,l.createElement)(s.ToolbarButton,{icon:"edit",disabled:!o||!i,title:(0,n.__)("Edit Email","mailster"),onClick:h}),(0,l.createElement)(s.ToolbarButton,{icon:"welcome-add-page",title:(0,n.__)("New Email","mailster"),onClick:f})),c.length>0&&(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TreeSelect,{label:(0,n.__)("Email","mailster"),help:(0,n.__)("Select an email you like to send in this step","mailster"),noOptionLabel:(0,n.__)("Select a email","mailster"),value:o,onChange:e=>{a({campaign:e?parseInt(e,10):void 0})},tree:c.map(((e,t)=>({name:(0,n.sprintf)("[#%d] %s",e.ID,e.title),id:e.ID})))})),(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.ButtonGroup,null,(0,l.createElement)(s.Button,{variant:"secondary",onClick:h,disabled:!o||!i},(0,n.__)("Edit Email","mailster"))," ",(0,l.createElement)(s.Button,{variant:"secondary",onClick:f},(0,n.__)("New Email","mailster"))),d&&(0,l.createElement)(s.Modal,{title:(0,n.__)("Email for this step","mailster"),className:"mailster-edit-campaign-modal",onRequestClose:()=>p(!1),shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,isFullScreen:!1,__experimentalHideHeader:!1},(0,l.createElement)("iframe",{src:d,id:"modal-iframe"}))))}function x(e){const{attributes:t,setAttributes:a,campaignObj:r}=e,{campaign:i,subject:o="",preheader:c="",from:u="",from_name:d="",name:p=""}=t;return(0,l.createElement)(m.InspectorControls,null,(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(_,{id:"64623ab58783627a4ed4c5ec",align:"right"}),(0,l.createElement)(N,e))),(0,l.createElement)(s.Panel,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("Name","mailster"),help:(0,n.__)("Set a name of this email.","mailster"),value:p,onChange:e=>a({name:e||void 0})}))),i&&(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("Subject","mailster"),help:(0,n.__)("Overwrite the subject line of this email.","mailster"),placeholder:r?.subject,value:o,onChange:e=>a({subject:e||void 0})})),(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("Preheader","mailster"),help:(0,n.__)("Overwrite the preheader of this email.","mailster"),placeholder:r?.preheader,value:c,onChange:e=>a({preheader:e||void 0})})),(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("From Email Address","mailster"),help:(0,n.__)("Overwrite the email address of this email.","mailster"),placeholder:r?.from,value:u,onChange:e=>a({from:e||void 0})})),(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.TextControl,{label:(0,n.__)("From Name","mailster"),help:(0,n.__)("Overwrite the from name of this email.","mailster"),placeholder:r?.from_name,value:d,onChange:e=>a({from_name:e||void 0})})))),(0,l.createElement)(s.Panel,null,i&&(0,l.createElement)(s.PanelBody,null,(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(s.Tip,null,(0,n.__)("Emails get queued in this step and sent by your current cron process.","mailster"))))))}const B=()=>(0,l.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 92.66 111.33"},(0,l.createElement)("g",{fill:"#d6d6d6"},(0,l.createElement)("path",{d:"M77.7 81.68H15.43c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM15.43 10.49h34.92c.44 0 .67-.22.67-.67s-.22-.67-.67-.67H15.43c-.44 0-.67.22-.67.67s.22.67.67.67zM77.7 77.66H15.43c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM76.52 14.82H16.6c-.92 0-1.84.73-1.84 1.7v35.02c0 .97.61 1.46 1.84 1.46h59.92c1.23 0 1.84-.49 1.84-1.46V16.28c0-.97-.61-1.46-1.84-1.46zM37.11 57.58H15.43c-.33 0-.67.33-.67.78v16.01c0 .44.22.67.67.67h21.68c.44 0 .67-.22.67-.67V58.25c0-.44-.22-.67-.67-.67zM77.7 57.58H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 61.6H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 65.61H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 69.63H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 73.65H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM37.11 88.5H15.43c-.33 0-.67.33-.67.78v16.01c0 .44.22.67.67.67h21.68c.44 0 .67-.22.67-.67V89.17c0-.44-.22-.67-.67-.67zM77.7 88.5H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 92.51H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 96.53H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 100.54H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67zM77.7 104.56H42.12c-.44 0-.67.22-.67.67s.22.67.67.67H77.7c.44 0 .67-.22.67-.67s-.22-.67-.67-.67z"}))),I=(0,l.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)("g",{fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"},(0,l.createElement)("path",{d:"M3 6.782v0c0 .591.293 1.144.782 1.475l5.981 4.053a4.001 4.001 0 004.488 0l5.966-4.044c.49-.33.783-.883.783-1.474v-.01C21 5.798 20.202 5 19.218 5H4.782C3.798 5 3 5.798 3 6.782z"}),(0,l.createElement)("path",{d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M3.586 18.414l6.14-6.14M14.281 12.281l6.13 6.13"}))),H=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/email","title":"Email","category":"mailster-workflow-steps","description":"Send an email.","parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"example":{"attributes":{"name":"Code is Poetry"}},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"name":{"type":"string"},"campaign":{"type":"integer"},"subject":{"type":"string"},"preheader":{"type":"string"},"comment":{"type":"string"}},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:T,...M}=H;(0,e.registerBlockType)(T,{...M,icon:I,__experimentalLabel:function(e,{context:t}){const{name:a,content:l,metadata:r}=e;return r?.name?r.name:(0,n.sprintf)((0,n.__)("Send Email %s","mailster"),'"'+a+'"')||l},edit:function(e){const{attributes:a,setAttributes:i,isSelected:o,clientId:m}=e,{id:c,campaign:u,subject:d,preheader:p,comment:h,isExample:f,name:_}=a,E=function(e,t=null,a=!0){const{getBlocks:l,getBlockRootClientId:n}=(0,r.select)("core/block-editor"),s=l(t);let i=[];return function t(l){l.forEach((l=>{l.name&&new RegExp(e,"g").test(l.name)&&(l.rootClientId=n(l.clientId),i.push(l)),a&&l.innerBlocks.length>0&&t(l.innerBlocks)}))}(s),i}("mailster-workflow/email"),w=E.findIndex((e=>e.clientId===m)),[b,g]=(0,l.useState)(!1),[y,v]=(0,l.useState)(),{invalidateResolutionForStore:k}=(0,r.useSelect)("mailster/automation"),{invalidateResolutionForStoreSelector:S}=(0,r.useDispatch)("mailster/automation"),C=(0,r.useSelect)((e=>e("mailster/automation").getCampaigns())),N=(0,r.useSelect)((e=>e("mailster/automation").getCampaignStats(u)),[u]);(0,l.useEffect)((()=>{g(I(u)),y&&i({name:y.title})}),[u,y]),(0,l.useEffect)((()=>{if(!C)return;if(!u)return;const e=C.filter((e=>e.ID==u));e.length&&v(e[0])}),[u,C]),(0,l.useEffect)((()=>{_||i({name:(0,n.sprintf)((0,n.__)("Email #%s","mailster"),w+1)})}),[E]),(0,l.useEffect)((()=>{S("getEmails")}),[u,_,c]);const I=e=>{if(!e)return!1;const t=new URL(location.origin+location.pathname.replace("post-new.php","post.php")),a=t.searchParams;a.set("post",e),a.set("action","preview_newsletter");const l={subject:d||y?.subject,preheader:p||y?.preheader};for(var n in l)l[n]&&a.append("replace["+n+"]",l[n]);return a.set("_cache",+new Date),t.toString()},H=d||y?.subject,T=b?(0,l.createElement)("iframe",{src:b,loading:"lazy",tabIndex:-1}):(0,l.createElement)(B,null);return(0,l.createElement)(P,t({},e,{isIncomplete:!u&&!f,inspectorControls:(0,l.createElement)(x,t({},e,{campaignObj:y}))}),(0,l.createElement)(s.CardBody,null,(0,l.createElement)("div",{className:"mailster-step-info"},(0,n.__)("Send Email","mailster"),u&&(0,l.createElement)("span",{className:"mailster-campaign-id"}," #",u)),(0,l.createElement)("div",{className:"mailster-step-label"},_)),(0,l.createElement)(s.CardMedia,null,(0,l.createElement)("div",{className:"email-preview"},H&&(0,l.createElement)("div",{className:"email-preview-subject"},H),T)),(0,l.createElement)(s.CardFooter,null,(0,l.createElement)("div",{className:"email-stats"},(0,l.createElement)("div",{className:"email-stats-sent"},(0,l.createElement)("div",{className:"email-stats-label"},(0,n.__)("Sent","mailster")),(0,l.createElement)("div",{className:"email-stats-value"},N?.sent||"-")),(0,l.createElement)("div",{className:"email-stats-opens"},(0,l.createElement)("div",{className:"email-stats-label"},(0,n.__)("Opened","mailster")),(0,l.createElement)("div",{className:"email-stats-value"},N?.opens||"-")),(0,l.createElement)("div",{className:"email-stats-clicks"},(0,l.createElement)("div",{className:"email-stats-label"},(0,n.__)("Clicked","mailster")),(0,l.createElement)("div",{className:"email-stats-value"},N?.clicks||"-")),(0,l.createElement)("div",{className:"email-stats-unsubs"},(0,l.createElement)("div",{className:"email-stats-label"},(0,n.__)("Unsubs","mailster")),(0,l.createElement)("div",{className:"email-stats-value"},N?.unsubs||"-")))))},save:()=>null})})()})();