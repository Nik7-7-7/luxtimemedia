(()=>{var e={6942:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function l(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return l.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(l.default=l,e.exports=l):void 0===(n=function(){return l}.apply(t,[]))||(e.exports=n)}()}},t={};function n(a){var l=t[a];if(void 0!==l)return l.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},t.apply(null,arguments)}const a=window.wp.element,l=window.wp.i18n,r=window.wp.components,s=window.wp.blockEditor,i=window.wp.date,o=window.wp.data,m=(0,i.getSettings)(),c=[{single:(0,l.__)("Minute","mailster"),plural:(0,l.__)("Minutes","mailster"),value:"minutes"},{single:(0,l.__)("Hour","mailster"),plural:(0,l.__)("Hours","mailster"),value:"hours"},{single:(0,l.__)("Day","mailster"),plural:(0,l.__)("Days","mailster"),value:"days"},{single:(0,l.__)("Week","mailster"),plural:(0,l.__)("Weeks","mailster"),value:"weeks"},{single:(0,l.__)("Month","mailster"),plural:(0,l.__)("Months","mailster"),value:"months"},{single:(0,l.__)("Specific Time of the day","mailster"),value:"day"},{single:(0,l.__)("Specific day of the week","mailster"),value:"week"},{single:(0,l.__)("Specific day of the month","mailster"),value:"month"},{single:(0,l.__)("Specific date","mailster"),value:"year"}],h={1:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("1st","[x] day of the month","mailster")),2:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("2nd","[x] day of the month","mailster")),3:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("3rd","[x] day of the month","mailster")),4:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("4th","[x] day of the month","mailster")),5:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("5th","[x] day of the month","mailster")),6:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("6th","[x] day of the month","mailster")),7:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("7th","[x] day of the month","mailster")),8:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("8th","[x] day of the month","mailster")),9:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("9th","[x] day of the month","mailster")),10:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("10th","[x] day of the month","mailster")),11:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("11st","[x] day of the month","mailster")),12:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("12nd","[x] day of the month","mailster")),13:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("13rd","[x] day of the month","mailster")),14:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("14th","[x] day of the month","mailster")),15:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("15th","[x] day of the month","mailster")),16:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("16th","[x] day of the month","mailster")),17:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("17th","[x] day of the month","mailster")),18:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("18th","[x] day of the month","mailster")),19:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("19th","[x] day of the month","mailster")),20:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("20th","[x] day of the month","mailster")),21:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("21st","[x] day of the month","mailster")),22:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("22nd","[x] day of the month","mailster")),23:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("23rd","[x] day of the month","mailster")),24:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("24th","[x] day of the month","mailster")),25:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("25th","[x] day of the month","mailster")),26:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("26th","[x] day of the month","mailster")),27:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("27th","[x] day of the month","mailster")),28:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("28th","[x] day of the month","mailster")),29:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("29th","[x] day of the month","mailster")),30:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("30th","[x] day of the month","mailster")),31:(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),(0,l._x)("31st","[x] day of the month","mailster")),"-1":(0,l.__)("Last day of the month","mailster")},d=m.l10n.weekdays,u=m.l10n.startOfWeek,f=m.formats.date,_=m.formats.time,p=(m.formats.datetime,!!m.formats.time.match(/[a|A]/));function y({id:e,align:t}){const n=new URL("https://kb.mailster.co/"+e);n.searchParams.set("utm_campaign","plugin"),n.searchParams.set("utm_medium","link"),n.searchParams.set("utm_source","Mailster Plugin"),n.searchParams.set("utm_term","workflow");var l={};return t&&(l.float=t),(0,a.createElement)("a",{className:"mailster-help",href:n.toString(),"data-article":e,style:l})}window.lodash,window.moment;const w=(0,l.__)("Wait for %s","mailster"),E=(0,l.__)("Wait until %s","mailster");function b(e){const{unit:t,amount:n,weekdays:a,date:r=new Date,month:s=1}=e;if(k(t))return"";switch(new Date(r),t){case"day":return"";case"week":if(!a||7==a.length)return(0,l.__)("on ever day in the week.","mailster");const e=d.filter(((e,t)=>a.includes(t))).join(", ").replace(/,([^,]*)$/," "+(0,l.__)("or","mailster")+"$1");return(0,l.sprintf)((0,l.__)("on a %s.","mailster"),e);case"month":return(0,l.sprintf)((0,l.__)("on the %s.","mailster"),h[s]);case"year":return(0,l.sprintf)((0,l.__)("on the %s.","mailster"),(0,i.dateI18n)(f,r))}return new Date(r).toString()}function g(e){const{unit:t,amount:n,weekdays:a,date:r=new Date,month:s=1}=e,o=function(e){const{unit:t,amount:n,weekdays:a,date:r=new Date,month:s=1}=e;if(k(t)){const e=c.find((e=>e.value===t));return(0,l.sprintf)("%d %s",n,n>1&&e.plural||e.single)}const o=new Date(r);switch(t){case"day":case"week":case"month":case"year":return(0,i.dateI18n)(_,o)}return(0,i.dateI18n)(_,o)}(e);return k(t)?(0,l.sprintf)(w,o):(0,l.sprintf)(E,o)}function k(e){return["minutes","hours","days","weeks","months"].includes(e)}const x=[...d.slice(u),...d.slice(0,u)];function v({attributes:e,setAttributes:t}){const{id:n,amount:o,date:m,unit:u,timezone:w,month:E,weekdays:b=[0,1,2,3,4,5,6]}=e,[k,v]=(0,a.useState)(!1),C=+new Date-+new Date(m)>0,S=e=>{t({date:new Date(e||Date.now()).toISOString()})},P=()=>(0,a.createElement)(r.Button,{variant:"tertiary",size:"small",onClick:()=>S(),className:"alignright"},(0,l.__)("now","mailster")),D=Object.keys(c).map(((e,t)=>({label:o>1&&c[e].plural||c[e].single,value:c[e].value})));return(0,a.createElement)(s.InspectorControls,null,(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(y,{id:"64623a1035c39a6db5f441e4",align:"right"}),(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("Delay Workflow","mailster")},(0,a.createElement)(r.Flex,{gap:4,align:"center",justify:"space-between"},["minutes","hours","days","weeks","months"].includes(u)&&(0,a.createElement)(a.Fragment,null,(0,l.__)("for","mailster"),(0,a.createElement)(r.FlexItem,null,(0,a.createElement)(r.__experimentalNumberControl,{onChange:e=>t({amount:parseInt(e,10)}),value:o,min:"1"}))),(0,a.createElement)(r.FlexItem,null,(0,a.createElement)(r.SelectControl,{value:u,options:D,onChange:e=>function(e){switch(e){case"month":E||t({month:1});break;case"year":C&&S(+new Date+864e5)}t({unit:e})}(e)}))))),"day"===u&&(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.Flex,{gap:4,align:"center",justify:"space-between"},(0,a.createElement)(r.BaseControl,{label:(0,l.__)("Wait until current time of the day is","mailster"),help:(0,l.__)("If the current time is later the workflow will be delayed by one day.","mailster")},(0,a.createElement)(r.FlexItem,null,(0,a.createElement)(r.Button,{variant:"secondary",onClick:e=>v(!0)},g(e),k&&(0,a.createElement)(r.Popover,{onClose:e=>v(!1),className:"delay-popover"},(0,a.createElement)(r.TimePicker,{currentTime:m,onChange:e=>S(e),is12Hour:p}),(0,a.createElement)(P,null))))))),"week"===u&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("Wait until current time of the day is","mailster")},(0,a.createElement)(r.Button,{variant:"secondary",onClick:e=>v(!0)},g(e),k&&(0,a.createElement)(r.Popover,{onClose:e=>v(!1),className:"delay-popover"},(0,a.createElement)(r.TimePicker,{currentTime:m,onChange:e=>S(e),is12Hour:p}),(0,a.createElement)(P,null))))),(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("only on","mailster"),help:(0,l.__)("If the current time is later the workflow will be delayed by next selected weekday.","mailster")},x.map(((e,n)=>{const l=d.indexOf(x[n]);return(0,a.createElement)(r.CheckboxControl,{className:"inspector-checkbox",key:l,label:x[n],checked:!b||b.includes(l),onChange:e=>{!function(e,n=!0){var a=[...b];n?a.push(e):a=a.filter((t=>t!=e)),t({weekdays:a.length?a.sort():void 0})}(l,e)},__nextHasNoMarginBottom:!0})}))))),"month"===u&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("Wait until current time of the day is","mailster")},(0,a.createElement)(r.Button,{variant:"secondary",onClick:e=>v(!0)},g(e),k&&(0,a.createElement)(r.Popover,{onClose:e=>v(!1),className:"delay-popover"},(0,a.createElement)(r.TimePicker,{currentTime:m,onChange:e=>S(e),is12Hour:p}),(0,a.createElement)(P,null))))),(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("and it is the","mailster"),help:(0,l.__)("If the current time is later the workflow will be delayed by next selected day in the next month.","mailster")},(0,a.createElement)(r.SelectControl,{value:E,options:Object.keys(h).map(((e,t)=>({label:h[e],value:e}))),onChange:e=>t({month:parseInt(e,10)})}))),E>=29&&(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.Tip,null,sprintf((0,l.__)("The month will be skipped if it doesn't have %d days.","mailster"),E)))),"year"===u&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.BaseControl,{label:(0,l.__)("Continue Workflow on the","mailster")},(0,a.createElement)(r.Button,{variant:"secondary",onClick:e=>v(!0),isDestructive:C},(0,i.dateI18n)(f,m)+" @ "+(0,i.dateI18n)(_,m),k&&(0,a.createElement)(r.Popover,{onClose:e=>v(!1),className:"delay-popover"},(0,a.createElement)(r.DateTimePicker,{currentDate:m,onChange:e=>S(e),is12Hour:p}),(0,a.createElement)(P,null))))),C&&(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.Button,{variant:"link",onClick:e=>v(!0),isDestructive:!0},(0,l.__)("Date is in the past!","mailster"))))),(0,a.createElement)((()=>["day","week","month","year"].includes(u)?(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.FlexItem,null,(0,a.createElement)(y,{id:"63fb2e7c52af714471a1738a",align:"right"}),(0,a.createElement)(r.ToggleControl,{onChange:()=>t({timezone:!w}),checked:w,label:(0,l.__)("Timezone based sending","mailster"),help:(0,l.__)("Delay based on the subscribers timezone if known. This is usefull if you have global subscribers and like to get the email in their in box at the defined time.","mailster")})))):null),null)))}var C=n(6942),S=n.n(C);const P=window.wp.apiFetch;var D=n.n(P);const B=(0,i.getSettings)(),I=((0,l.__)("Minute","mailster"),(0,l.__)("Minutes","mailster"),(0,l.__)("Hour","mailster"),(0,l.__)("Hours","mailster"),(0,l.__)("Day","mailster"),(0,l.__)("Days","mailster"),(0,l.__)("Week","mailster"),(0,l.__)("Weeks","mailster"),(0,l.__)("Month","mailster"),(0,l.__)("Months","mailster"),(0,l.__)("Specific Time of the day","mailster"),(0,l.__)("Specific day of the week","mailster"),(0,l.__)("Specific day of the month","mailster"),(0,l.__)("Specific date","mailster"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"1st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"2nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"3rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"4th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"5th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"6th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"7th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"8th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"9th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"10th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"11st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"12nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"13rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"14th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"15th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"16th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"17th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"18th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"19th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"20th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"21st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"22nd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"23rd"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"24th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"25th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"26th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"27th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"28th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"29th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"30th"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"31st"),(0,l.sprintf)((0,l.__)("%s day of the month","mailster"),"Last"),B.l10n.weekdays.slice(B.l10n.startOfWeek),B.l10n.weekdays.slice(0,B.l10n.startOfWeek),B.l10n.startOfWeek,B.formats.date),T=B.formats.time;function N(e){const{attributes:n}=e,{id:i}=n,m=(0,o.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[c,h]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),f=function(e){const t=(0,o.useSelect)((e=>e("mailster/automation").getQueue()),[]),[n,l]=(0,a.useState)(0);return(0,a.useEffect)((()=>{t&&l(t[e]||0)}),[e,t]),n}(i),_=(0,l.sprintf)((0,l._n)("%s subscriber queued","%s subscribers queued",f,"mailster"),f);return(0,a.useEffect)((()=>{if(c&&i&&m)return f?void D()({path:"/mailster/v1/automations/queue/"+m+"/"+i}).then((e=>{u(e)})):u([])}),[c,m,i,f]),(0,a.createElement)(a.Fragment,null,f>0&&(0,a.createElement)("span",{className:"mailster-step-queued",title:_,onClick:()=>h(!0)},f),c&&(0,a.createElement)(r.Modal,{title:_,onRequestClose:()=>h(!1)},(0,a.createElement)(y,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,a.createElement)("div",{className:"mailster-queue-table"},!d&&(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.Spinner,null)))),d&&(0,a.createElement)(M,t({data:d,setData:u},e))),(0,a.createElement)(r.Tip,null,(0,l.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster"))),(0,a.createElement)(s.InspectorControls,null,f>0&&(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,{title:(0,l.__)("Queue","mailster")},(0,a.createElement)(y,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.Button,{onClick:()=>h(!0),variant:"secondary"},_))),(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.Tip,null,(0,l.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster"))))))}B.formats.datetime,B.formats.time.match(/[a|A]/);const M=e=>{const{attributes:t,data:n,setData:s}=e,{id:m}=t,[c,h]=(0,a.useState)(!1),d=(0,o.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),u=(e,t,a,l)=>{const r="/mailster/v1/automations/queue/"+d+"/"+m+"/"+e.ID;h(!0),D()({path:r,method:a,data:l}).then((e=>{e&&s(n.filter(((e,n)=>n!==t))),h(!1),(0,o.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},f=(new Date).getTime(),_=n.map(((e,n)=>{const s=1e3*e.timestamp,o=1e3*e.added;return(0,a.createElement)("tr",{key:n},(0,a.createElement)("td",null,(0,a.createElement)(r.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id},e.email),0==e.status&&(0,a.createElement)("p",{className:"description"},(0,l.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster"))),(0,a.createElement)("td",null,e.trigger),(0,a.createElement)("td",null,o&&(0,a.createElement)(r.Tooltip,{text:(0,i.dateI18n)(I,o)+" @ "+(0,i.dateI18n)(T,o)},(0,a.createElement)("div",null,(0,i.humanTimeDiff)(o)))),(0,a.createElement)("td",null,s&&(0,a.createElement)(r.Tooltip,{text:(0,i.dateI18n)(I,s)+" @ "+(0,i.dateI18n)(T,s)},(0,a.createElement)("div",null,s>f?(0,i.humanTimeDiff)(s):(0,l.__)("right now","mailster")))),(0,a.createElement)("td",null,(0,a.createElement)(r.Button,{icon:"flag",disabled:c,label:(0,l.__)("Finish Journey","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(n)&&u(e,t,"POST",{finish:!0})})(e,n)}),(0,a.createElement)(r.Button,{icon:"controls-skipforward",disabled:c||1!=e.status||t.disabled,label:(0,l.__)("Forward to next step","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(n)&&u(e,t,"POST",{forward:!0})})(e,n)}),(0,a.createElement)(r.Button,{icon:"trash",disabled:c,isDestructive:!0,label:(0,l.__)("Remove entry","mailster"),onClick:()=>((e,t)=>{const n=(0,l.sprintf)((0,l.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(n)&&u(e,t,"DELETE")})(e,n)})))}));return(0,a.createElement)("table",{className:"wp-list-table widefat striped"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,l.__)("Subscriber","mailster")),(0,a.createElement)("th",null,(0,l.__)("Trigger","mailster")),(0,a.createElement)("th",null,(0,l.__)("Added","mailster")),(0,a.createElement)("th",null,(0,l.__)("Continues","mailster")),(0,a.createElement)("th",{style:{width:"150px"}},(0,l.__)("Actions","mailster")))),(0,a.createElement)("tbody",null,_))},F={label:(0,l.__)("Skip Step","mailster"),help:(0,l.__)("Skip this step when the workflow is executed.","mailster")},R={label:(0,l.__)("Skip Trigger","mailster"),help:(0,l.__)("Disable this trigger for the workflow.","mailster")};function O(e){const{attributes:t,setAttributes:n,name:l}=e,{disabled:i=!1}=t;if("mailster-workflow/stop"===l)return null;const o="mailster-workflow/trigger"==l?R:F;return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.BlockControls,{group:"other"},(0,a.createElement)(r.ToolbarButton,{icon:i?"hidden":"visibility",isPressed:i,title:o.label,onClick:()=>n({disabled:!i||void 0})})),(0,a.createElement)(s.InspectorControls,null,(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.ToggleControl,{icon:i?"hidden":"visibility",label:o.label,help:o.help,checked:i,onChange:e=>n({disabled:!!e||void 0})}))))))}function W(e){const{attributes:t,setAttributes:n,name:i}=e,{comment:o=""}=t;return"mailster-workflow/trigger"===i?null:(0,a.createElement)(a.Fragment,null,o&&(0,a.createElement)("div",{className:"mailster-step-comment"},o),(0,a.createElement)(s.InspectorControls,null,(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.PanelRow,null,(0,a.createElement)(r.TextControl,{label:(0,l.__)("Comment","mailster"),help:(0,l.__)("Add a comment to help you understand your workflow.","mailster"),value:o,onChange:e=>n({comment:e||void 0})}))))))}function j(e){const{attributes:t}=e,{id:n}=t;if(n)return(0,a.createElement)(a.Fragment,null,(0,a.createElement)("span",{className:"mailster-step-id",title:sprintf((0,l.__)("Step ID : %s","mailster"),n)},n),(0,a.createElement)(s.InspectorControls,null,(0,a.createElement)(r.Panel,null,(0,a.createElement)(r.PanelBody,null,(0,a.createElement)(r.PanelRow,{className:"code"},sprintf((0,l.__)("Step ID : %s","mailster"),n))))))}function A(e){const{attributes:t,clientId:n,name:i,isSelectionEnabled:m}=e,{isExample:c}=t;if((0,o.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const h="mailster-workflow/triggers"===i?(0,l.__)("Click + to add a step","mailster"):(0,l.__)("Workflow Finished","mailster");return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.Tooltip,{text:(0,l.__)("Once the user reaches this point the workflow will be finished.","mailster")},(0,a.createElement)("span",{className:"workflow-finished "+i.replace("mailster-workflow/","workflow-finished-")},!c&&h)),m&&(0,a.createElement)(s.ButtonBlockAppender,null))}function q(e){const{attributes:t,setAttributes:n,children:l,className:i=[],hasStepId:m=!0,before:c,after:h,inspectorControls:d,isSelected:u,isIncomplete:f,clientId:_,blockAttributes:p={},isSelectionEnabled:y}=e,{id:w,disabled:E=!1}=t;!function(e){const[t,n]=(0,a.useState)();(0,a.useEffect)((()=>{new Promise((e=>{const t=(0,o.subscribe)((()=>{if((0,o.select)("core/editor").isCleanNewPost()||(0,o.select)("core/block-editor").getBlockCount()>0){const n=document.querySelector('iframe[name="editor-canvas"]'),a=n?n.contentWindow:window,l=()=>{a.removeEventListener("load",l),t(),e(a)};a.document.querySelector(".is-root-container")?l():a.addEventListener("load",l)}}))})).then((t=>{n(t.document),e&&e(t.document)}))}),[])}((e=>{e&&m&&(!w||e.querySelectorAll(".mailster-step-"+w).length>1)&&n({id:_.substring(30)})})),(0,a.useEffect)((()=>{if(u&&w)return history.replaceState(void 0,void 0,"#step-"+w),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[u]);const b=(0,a.useRef)();w&&i.push("mailster-step-"+w),f&&y&&i.push("mailster-step-incomplete"),E&&i.push("mailster-step-disabled");const g=(0,s.useBlockProps)({className:S()({},i),...p});return(0,a.createElement)(a.Fragment,null,d,(0,a.createElement)("div",g,c,(0,a.createElement)(r.Card,{className:"mailster-step",ref:b},(0,a.createElement)(W,e),(0,a.createElement)(O,e),(0,a.createElement)(N,e),(0,a.createElement)(j,e),(0,a.createElement)("div",{className:"mailster-step-inner"},l)),h,(0,a.createElement)("div",{className:"end-stop canvas-handle"})),(0,a.createElement)(A,e))}const H=(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)("g",{fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"},(0,a.createElement)("path",{d:"M12 21v0a9 9 0 009-9v0a9 9 0 00-9-9v0a9 9 0 00-9 9v0a9 9 0 009 9z"}),(0,a.createElement)("path",{d:"M14 14l-2-2V9M5.5 12H6M18.5 12H18M7.76 16.24l-.36.36M16.24 7.76l.36-.36M12 18v.5M12 5.5V6M16.24 16.24l.36.36M7.4 7.4l.36.36"})),(0,a.createElement)("path",{fill:"none",d:"M0 0h24v24H0V0z"})),z=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/delay","title":"Delay","category":"mailster-workflow-steps","keywords":["delay","time"],"description":"Delay your workflow and continue at a later point.","parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"amount":{"type":"integer"},"unit":{"type":"string"},"date":{"type":"string"},"weekdays":{"type":"array"},"month":{"type":"integer"},"timezone":{"type":"boolean","default":false},"comment":{"type":"string"}},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:L,...V}=z;(0,e.registerBlockType)(L,{...V,__experimentalLabel:function(e,{context:t}){const{content:n,metadata:a}=e;if(a?.name)return a.name;const r=b(e),s=g(e);return(0,l.sprintf)("%s %s",s,r)||n},icon:H,edit:function(e){const{attributes:n,setAttributes:s}=e,{amount:i,unit:o,date:m,month:c,timezone:h}=n;(0,a.useEffect)((()=>{!i&&s({amount:1}),!o&&s({unit:"hours"}),!c&&s({month:1}),!m&&s({date:new Date})}));const d=b(n),u=g(n);return(0,a.createElement)(q,t({},e,{className:[],inspectorControls:(0,a.createElement)(v,e)}),(0,a.createElement)(r.CardBody,{size:"small"},(0,a.createElement)("div",{className:"mailster-step-label"},(0,a.createElement)(r.Icon,{icon:H}),u),d&&(0,a.createElement)("div",{className:"mailster-step-info"},d),!k()&&h&&(0,a.createElement)("div",{className:"mailster-step-info"},(0,a.createElement)("br",null),(0,l.__)("Respect users timezone","mailster"))))},save:()=>null})})()})();